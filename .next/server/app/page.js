(()=>{var e={};e.id=1931,e.ids=[1931],e.modules={11185:e=>{"use strict";e.exports=require("mongoose")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},6005:e=>{"use strict";e.exports=require("node:crypto")},41041:e=>{"use strict";e.exports=require("node:url")},79231:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c}),a(90908),a(50134),a(35866);var s=a(23191),r=a(88716),i=a(37922),n=a.n(i),l=a(95231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);a.d(t,o);let c=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,90908)),"/Users/meneer.groot/GitHub/LOOPCHAN/app/page.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,50134)),"/Users/meneer.groot/GitHub/LOOPCHAN/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/meneer.groot/GitHub/LOOPCHAN/app/page.tsx"],u="/page",m={require:a,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},33412:(e,t,a)=>{Promise.resolve().then(a.bind(a,9097))},9097:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>N});var s=a(10326),r=a(17577),i=a(35047),n=a(86333),l=a(76557);let o=(0,l.Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),c=(0,l.Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);var d=a(40617),u=a(49758),m=a(71709),p=a(37358);let h=(0,l.Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),x=(0,l.Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var g=a(87130),y=a(31556),b=a(14829),v=a(51471);let w=({threads:e,onThreadSelect:t,onBack:a,showBackButton:i=!0,loading:l=!1,onThreadCreated:w})=>{let{wallet:f}=(0,y.O)(),{processPayment:j}=(0,b.J)(),[N,A]=(0,r.useState)(1),[C,D]=(0,r.useState)(1),[k,P]=(0,r.useState)(!1),[q,_]=(0,r.useState)(!1),[T,S]=(0,r.useState)(e),L=e=>{try{if(null==e)return"No date";let t="string"==typeof e?new Date(e):e;if(isNaN(t.getTime()))return console.warn("Invalid date value:",e),"Invalid date";return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)}catch(t){return console.error("Error formatting date:",t,e),"Invalid date"}},z=async(e,t=!1)=>{t||_(!0);try{let a=await v.s.getThreads(e),s=(a.threads||[]).map(e=>{try{if(!e)return console.warn("Thread is null or undefined:",e),null;return e.op||(console.warn("Thread missing op property, creating fallback:",e),e.op={id:`fallback_${e.id}`,timestamp:new Date(e.createdAt||Date.now()),content:e.title||"No content",authorWallet:e.authorWallet||"unknown",isAnonymous:!0}),{...e,lastReply:new Date(e.lastReply||Date.now()),createdAt:new Date(e.createdAt||Date.now()),lastActivity:new Date(e.lastActivity||Date.now()),op:{...e.op,timestamp:new Date(e.op.timestamp||Date.now())}}}catch(t){return console.error("Error normalizing thread:",t,e),{...e,lastReply:new Date,createdAt:new Date,lastActivity:new Date,op:{...e.op,timestamp:new Date}}}}).filter(Boolean);t&&s.length===T.length||S(s),D(a.totalPages||1)}catch(e){console.error("Failed to load threads:",e),t||(S([]),D(1))}finally{t||_(!1)}};(0,r.useEffect)(()=>{e.length>0&&(console.log("Normalizing initial threads:",e.length),S(e.map(e=>{try{if(console.log("Normalizing initial thread:",e.id,"with dates:",{lastReply:e.lastReply,createdAt:e.createdAt,lastActivity:e.lastActivity,opTimestamp:e.op?.timestamp}),!e)return console.warn("Initial thread is null or undefined:",e),null;return e.op||(console.warn("Initial thread missing op property, creating fallback:",e),e.op={id:`fallback_${e.id}`,timestamp:new Date(e.createdAt||Date.now()),content:e.title||"No content",authorWallet:e.authorWallet||"unknown",isAnonymous:!0}),{...e,lastReply:new Date(e.lastReply||Date.now()),createdAt:new Date(e.createdAt||Date.now()),lastActivity:new Date(e.lastActivity||Date.now()),op:{...e.op,timestamp:new Date(e.op.timestamp||Date.now())}}}catch(t){return console.error("Error normalizing initial thread:",t,e),{...e,lastReply:new Date,createdAt:new Date,lastActivity:new Date,op:{...e.op,timestamp:new Date}}}}).filter(Boolean)))},[e]),(0,r.useEffect)(()=>{let e=()=>{!document.hidden&&T.length>0&&z(N,!0)};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[N,T.length]),(0,r.useEffect)(()=>{0===e.length&&z(N)},[N,e.length]);let R=async e=>{if(!f.connected||!f.publicKey){alert("Please connect your Solana wallet to create a thread");return}let t=`temp_thread_${Date.now()}_${Math.random().toString(36).substring(2,15)}`;try{let a,s,r;if(e.image)try{s=(await v.s.uploadFile(e.image,f.publicKey)).url}catch(e){console.error("Failed to upload image:",e),alert("Failed to upload image. Please try again.");return}if(e.video)try{r=(await v.s.uploadFile(e.video,f.publicKey)).url}catch(e){console.error("Failed to upload video:",e),alert("Failed to upload video. Please try again.");return}let i=e.title.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50),n={id:t,slug:i,title:e.title,op:{id:`temp_post_${Date.now()}_${Math.random().toString(36).substring(2,15)}`,timestamp:new Date,content:e.content||null,image:s||null,imageThumb:s||null,video:r||null,authorWallet:f.publicKey||"anonymous",isAnonymous:!0},replies:[],lastReply:new Date,replyCount:0,imageCount:s?1:0,videoCount:r?1:0,board:"main",page:1,createdAt:new Date,lastActivity:new Date,authorWallet:f.publicKey||"anonymous",isOptimistic:!0};S(e=>[n,...e]),P(!1),A(1),console.log("Sending thread creation request to server...");let l=null;try{a=await v.s.createThread({title:e.title,content:e.content,image:s||void 0,video:r||void 0,authorWallet:f.publicKey})}catch(n){let i=n.message||"";if(i.includes("Payment required")||i.includes("402")){if(console.log("Payment required, processing payment..."),!(l=await j())){S(e=>e.filter(e=>e.id!==t)),alert("Payment failed or was cancelled. Thread creation cancelled.");return}a=await v.s.createThread({title:e.title,content:e.content,image:s||void 0,video:r||void 0,authorWallet:f.publicKey,paymentSignature:l})}else throw n}if(console.log("Thread created successfully:",a),!a.success||!a.thread)throw Error("Thread creation failed - invalid response from server");S(e=>e.map(e=>e.id===t?{...a.thread,isOptimistic:!1}:e)),w&&w()}catch(e){console.error("Failed to create thread:",e),S(e=>e.filter(e=>e.id!==t)),alert("Failed to create thread. Please try again.")}},E=e=>{e>=1&&e<=C&&A(e)};return(0,s.jsxs)("div",{className:"max-w-6xl mx-auto p-6 bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("div",{className:"flex items-center space-x-4",children:i&&a&&(0,s.jsxs)("button",{onClick:a,className:"flex items-center space-x-2 text-orange-600 hover:text-orange-700 transition-colors",children:[s.jsx(n.Z,{size:20}),s.jsx("span",{children:"Back to boards"})]})}),(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsxs)("button",{onClick:()=>z(N),disabled:q,className:"flex items-center space-x-2 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg",title:"Refresh threads",children:[s.jsx(o,{size:18,className:q?"animate-spin":""}),s.jsx("span",{children:"Refresh"})]}),f.connected&&f.publicKey&&(0,s.jsxs)("button",{onClick:()=>P(!0),className:"flex items-center space-x-2 bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg",children:[s.jsx(c,{size:18}),s.jsx("span",{children:"Start New Thread"})]})]})]}),i&&(0,s.jsxs)("div",{className:"text-center mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold text-orange-600 mb-2",children:"LoopChan"}),(0,s.jsxs)("p",{className:"text-gray-600",children:["Page ",N," of ",C]})]}),k&&s.jsx("div",{className:"mb-6",children:s.jsx(g.s,{onSubmit:R,onCancel:()=>P(!1)})}),q||l?(0,s.jsxs)("div",{className:"text-center py-12",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto"}),s.jsx("p",{className:"text-orange-500 mt-4",children:"Loading threads..."})]}):0===T.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[s.jsx(d.Z,{className:"mx-auto text-orange-400 mb-4",size:48}),s.jsx("p",{className:"text-orange-500",children:"No threads yet. Be the first to post!"})]}):(0,s.jsxs)(s.Fragment,{children:[s.jsx("div",{className:"max-w-4xl mx-auto space-y-6",children:T.map(e=>{try{return s.jsx("div",{onClick:()=>{let a=e.slug?`/thread/${e.slug}`:`/threads/${e.id}`;e.isOptimistic?setTimeout(()=>{t?.(a)},1e3):(v.s.getThread(e.id).catch(console.error),t?.(a))},className:`bg-white border rounded-lg p-6 hover:bg-gray-50 hover:border-orange-200 hover:shadow-md transition-all duration-200 cursor-pointer group shadow-sm ${e.isOptimistic?"border-blue-300 bg-blue-50":"border-gray-200"}`,children:(0,s.jsxs)("div",{className:"flex items-start space-x-4",children:[e.op&&e.op.image&&s.jsx("img",{src:e.op.imageThumb||e.op.image,alt:"Thread image",className:"w-16 h-16 object-cover rounded-lg flex-shrink-0"}),e.op&&e.op.video&&!e.op.image&&s.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg flex-shrink-0 flex items-center justify-center",children:s.jsx(u.Z,{size:24,className:"text-gray-400"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-800 group-hover:text-orange-600 transition-colors",children:e.title}),e.isOptimistic&&s.jsx("span",{className:"text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full",children:"Posting..."})]}),s.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-3",children:e.op?.content||""}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[s.jsx(d.Z,{size:12}),(0,s.jsxs)("span",{children:[e.replyCount," replies"]})]}),e.imageCount>0&&(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[s.jsx(m.Z,{size:12}),(0,s.jsxs)("span",{children:[e.imageCount," images"]})]}),e.videoCount>0&&(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[s.jsx(u.Z,{size:12}),(0,s.jsxs)("span",{children:[e.videoCount," videos"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[s.jsx(p.Z,{size:12}),s.jsx("span",{children:L(e.lastReply)})]})]})]})]})},e.id)}catch(t){return console.error("Error rendering thread:",t,e),s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:(0,s.jsxs)("p",{className:"text-red-600",children:["Error displaying thread: ",e.id]})},e.id)}})}),C>1&&(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-2 mt-8",children:[(0,s.jsxs)("button",{onClick:()=>E(N-1),disabled:1===N,className:"flex items-center space-x-1 px-3 py-2 text-orange-600 hover:text-orange-700 disabled:text-gray-400 disabled:cursor-not-allowed",children:[s.jsx(h,{size:16}),s.jsx("span",{children:"Previous"})]}),s.jsx("div",{className:"flex space-x-1",children:Array.from({length:Math.min(5,C)},(e,t)=>{let a=Math.max(1,Math.min(C-4,N-2))+t;return s.jsx("button",{onClick:()=>E(a),className:`px-3 py-2 rounded-lg ${a===N?"bg-orange-500 text-white":"text-orange-600 hover:bg-orange-100"}`,children:a},a)})}),(0,s.jsxs)("button",{onClick:()=>E(N+1),disabled:N===C,className:"flex items-center space-x-1 px-3 py-2 text-orange-600 hover:text-orange-700 disabled:text-gray-400 disabled:cursor-not-allowed",children:[s.jsx("span",{children:"Next"}),s.jsx(x,{size:16})]})]})]})]})};var f=a(86178),j=a(35295);function N(){let e=(0,i.useRouter)(),[t,a]=(0,r.useState)([]),[n,l]=(0,r.useState)(!0),o=(0,r.useCallback)(async()=>{try{l(!0);let e=await v.s.getThreads(1);e.success&&a(e.threads||[])}catch(e){console.error("Error loading threads:",e)}finally{l(!1)}},[]),c=(0,r.useCallback)(t=>{e.push(t)},[e]),d=(0,r.useCallback)(()=>{o()},[o]);return(0,s.jsxs)("div",{className:"min-h-screen",children:[s.jsx(f.h,{title:"LoopChan",showHomeLink:!1,showAdvertiseLink:!0}),(0,s.jsxs)("main",{className:"max-w-6xl mx-auto px-6 py-8",children:[(0,s.jsxs)("div",{className:"text-center mb-12",children:[s.jsx("h1",{className:"text-4xl font-bold text-orange-600 mb-4",children:"LoopChan"}),s.jsx("p",{className:"text-xl text-gray-600 mb-6",children:"Anonymous imageboard discussion"}),s.jsx("hr",{className:"border-gray-300 mb-8"}),s.jsx("div",{className:"text-left max-w-4xl mx-auto",children:s.jsx("p",{className:"text-gray-700 leading-relaxed",children:"LoopChan is a simple image-based bulletin board where anyone can post comments and share images. All discussions happen in one place - no separate boards, just pure anonymous discussion. Users need to connect a Solana Wallet before participating in the community. Feel free to start a new thread or join the conversation!"})})]}),s.jsx(w,{threads:t,showBackButton:!1,loading:n,onThreadSelect:c,onThreadCreated:d})]}),s.jsx(j.$,{})]})}},35295:(e,t,a)=>{"use strict";a.d(t,{$:()=>r});var s=a(10326);a(17577);let r=()=>s.jsx("footer",{className:"mt-12",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-6",children:[(0,s.jsxs)("div",{className:"bg-white border border-orange-200 rounded-lg p-6 shadow-sm",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Board Rules"}),(0,s.jsxs)("ul",{className:"text-gray-600 space-y-2",children:[s.jsx("li",{children:"• Be respectful to other users"}),s.jsx("li",{children:"• Stay on topic for each board"}),s.jsx("li",{children:"• No spam or duplicate threads"}),s.jsx("li",{children:"• No underage images"})]}),s.jsx("hr",{className:"border-gray-300 my-6"}),s.jsx("p",{className:"text-gray-600 text-sm leading-relaxed",children:"By using this website (the \"site\"), you agree that you'll follow these rules, and understand that if we reasonably think you haven't followed these rules, we may (at our own discretion) terminate your access to the site:"})]}),(0,s.jsxs)("div",{className:"text-center mt-6 space-y-2",children:[s.jsx("p",{className:"text-gray-600 text-sm",children:"LoopChan - Anonymous discussion platform powered by Solana"}),s.jsx("p",{className:"text-gray-600 text-sm",children:"All posts are anonymous. Connect your Solana wallet to create threads and post replies."})]})]})})},90908:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});let s=(0,a(68570).createProxy)(String.raw`/Users/meneer.groot/GitHub/LOOPCHAN/app/page.tsx#default`)}};var t=require("../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[9276,2892,52,6295,3250],()=>a(79231));module.exports=s})();