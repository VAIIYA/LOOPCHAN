"use strict";(()=>{var e={};e.id=5998,e.ids=[5998],e.modules={38013:e=>{e.exports=require("mongodb")},11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},76162:e=>{e.exports=require("stream")},78981:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>w,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>f,staticGenerationAsyncStorage:()=>c});var o={};t.r(o),t.d(o,{POST:()=>d});var a=t(49303),i=t(88716),s=t(60670),n=t(87070),p=t(29342);let u=["video/webm","video/mp4","video/quicktime"],l=["image/jpeg","image/jpg","image/png","image/gif","image/webp",...u];async function d(e){try{let r=await e.formData(),t=r.get("file"),o=r.get("authorWallet");if(!o)return console.warn("Upload attempted without wallet connection"),n.NextResponse.json({error:"Wallet connection required. Please connect your Solana wallet."},{status:401});if(!t)return n.NextResponse.json({error:"No file provided"},{status:400});if(!l.includes(t.type))return n.NextResponse.json({error:`File type not allowed. Allowed types: ${l.join(", ")}`},{status:400});let a=u.includes(t.type),i=a?10485760:5242880;if(t.size>i)return n.NextResponse.json({error:`File too large. Maximum size for ${a?"videos":"images"}: ${i/1048576}MB`},{status:400});let s=Date.now(),d=Math.random().toString(36).substring(2,15),m=t.name.split(".").pop()?.toLowerCase(),g={"image/jpeg":"jpg","image/jpg":"jpg","image/png":"png","image/gif":"gif","image/webp":"webp","video/webm":"webm","video/mp4":"mp4","video/quicktime":"mov"}[t.type],c=`${s}-${d}.${m===g?m:g}`,f=await t.arrayBuffer(),v=Buffer.from(f),w=await (0,p.OL)(v,c,t.type,o);return n.NextResponse.json({url:`/api/files/${w}`,blobId:w,fileId:w,filename:c,fileType:t.type,isVideo:a})}catch(e){return console.error("Upload error:",e),console.error("Upload error details:",{message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0}),n.NextResponse.json({error:"Failed to upload file",details:void 0},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"/Users/meneer.groot/GitHub/LOOPCHAN/app/api/upload/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:g,staticGenerationAsyncStorage:c,serverHooks:f}=m,v="/api/upload/route";function w(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:c})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[9276,5972,9342],()=>t(78981));module.exports=o})();