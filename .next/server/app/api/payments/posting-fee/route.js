"use strict";(()=>{var e={};e.id=9550,e.ids=[9550],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},6005:e=>{e.exports=require("node:crypto")},41041:e=>{e.exports=require("node:url")},66214:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>N,requestAsyncStorage:()=>S,routeModule:()=>g,serverHooks:()=>x,staticGenerationAsyncStorage:()=>q});var n={};r.r(n),r.d(n,{GET:()=>w,POST:()=>y});var a=r(49303),i=r(88716),o=r(60670),s=r(87070),u=r(89823),d=r(51575),l=r(73591),p=r(28301),c=r(90528);let m=new u.nh("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),f=process.env.SOLANA_RPC_URL||"https://api.mainnet-beta.solana.com";async function y(e){try{let{fromWallet:t}=await e.json();if(!t)return s.NextResponse.json({error:"Wallet address is required"},{status:400});let r=new u.ew(f,"confirmed"),n=new u.nh(t),a=new u.nh(c.j9),i=await (0,d.Am)(m,n),o=await (0,d.Am)(m,a);try{await (0,l.D0)(r,i)}catch(e){return s.NextResponse.json({error:"USDC token account not found. Please ensure you have USDC in your wallet.",code:"NO_TOKEN_ACCOUNT"},{status:400})}try{await (0,l.D0)(r,o)}catch(e){return s.NextResponse.json({error:"Treasury USDC account not configured. Please contact support.",code:"TREASURY_NOT_CONFIGURED"},{status:500})}let y=await (0,l.D0)(r,i),w=Number(y.amount)/1e6;if(w<c.md)return s.NextResponse.json({error:`Insufficient USDC balance. Required: ${c.md} USDC, Available: ${w.toFixed(6)} USDC`,code:"INSUFFICIENT_BALANCE",required:c.md,available:w},{status:400});let g=Math.floor(1e6*c.md),S=(0,p.$B)(i,o,n,g),q=new u.YW().add(S),{blockhash:x}=await r.getLatestBlockhash("finalized");q.recentBlockhash=x,q.feePayer=n;let h=q.serialize({requireAllSignatures:!1,verifySignatures:!1});return s.NextResponse.json({success:!0,transaction:Buffer.from(h).toString("base64"),amount:c.md,treasury:c.j9,message:"Transaction created. Please sign and send it with your wallet."})}catch(e){return console.error("Posting fee transaction creation error:",e),s.NextResponse.json({error:e instanceof Error?e.message:"Failed to create transaction",code:"TRANSACTION_ERROR"},{status:500})}}async function w(e){try{let{searchParams:t}=new URL(e.url),r=t.get("signature"),n=t.get("fromWallet");if(!r||!n)return s.NextResponse.json({error:"Signature and fromWallet are required"},{status:400});let a=new u.ew(f,"confirmed");await new Promise(e=>setTimeout(e,2e3));let i=await a.getTransaction(r,{commitment:"confirmed",maxSupportedTransactionVersion:0});if(!i)return s.NextResponse.json({verified:!1,error:"Transaction not found"},{status:404});if(i.meta?.err)return s.NextResponse.json({verified:!1,error:"Transaction failed"},{status:400});let o=new u.nh(c.j9),l=await (0,d.Am)(m,o);if((i.meta?.postTokenBalances||[]).some(e=>e.mint===m.toString()&&e.owner===l.toString()&&(Number(e.uiTokenAmount?.uiAmount)||0)>=c.md))return s.NextResponse.json({verified:!0,signature:r,amount:c.md});return s.NextResponse.json({verified:!1,error:"Transaction does not include required payment"},{status:400})}catch(e){return console.error("Payment verification error:",e),s.NextResponse.json({verified:!1,error:e instanceof Error?e.message:"Verification failed"},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/payments/posting-fee/route",pathname:"/api/payments/posting-fee",filename:"route",bundlePath:"app/api/payments/posting-fee/route"},resolvedPagePath:"/Users/meneer.groot/GitHub/LOOPCHAN/app/api/payments/posting-fee/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:S,staticGenerationAsyncStorage:q,serverHooks:x}=g,h="/api/payments/posting-fee/route";function N(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:q})}},90528:(e,t,r)=>{r.d(t,{GJ:()=>d,Jw:()=>c,UY:()=>p,bW:()=>f,j9:()=>o,md:()=>s,vg:()=>m});var n=r(75637),a=r(11185),i=r.n(a);let o="2sRhKuPffCwT2uuGVu3DXDsLFmjv78uKkEMd9UYrF5jv",s=.01;async function u(){if(!i().connections[0].readyState){if(!process.env.MONGODB_URI)throw Error("MONGODB_URI is not defined");await i().connect(process.env.MONGODB_URI)}}function d(e){return"2Z9eW3nwa2GZUM1JzXdfBK1MN57RPA2PrhuTREEZ31VY"===e}async function l(e){if(d(e))return!0;try{return await u(),!!await n.Mod.findOne({walletAddress:e}).lean()}catch(e){return console.error("Error checking if wallet is mod:",e),!1}}async function p(e){return d(e)||await l(e)}async function c(){return await u(),await n.Mod.find({}).sort({addedAt:-1}).lean()}async function m(e,t){if(await u(),await n.Mod.findOne({walletAddress:e}))throw Error("Wallet is already a mod");let r=new n.Mod({walletAddress:e,addedBy:t});return await r.save(),r}async function f(e){if(await u(),d(e))throw Error("Cannot remove admin");return(await n.Mod.deleteOne({walletAddress:e})).deletedCount>0}},75637:(e,t,r)=>{r.r(t),r.d(t,{File:()=>f,Mod:()=>w,Post:()=>m,Thread:()=>c,User:()=>p,UserProfile:()=>y});var n=r(11185),a=r.n(n);let i=new(a()).Schema({email:{type:String,required:!0,unique:!0,lowercase:!0,trim:!0},password:{type:String,required:!0},name:{type:String,default:"Anonymous"},createdAt:{type:Date,default:Date.now}},{timestamps:!0}),o=new(a()).Schema({id:{type:String,required:!0,unique:!0},threadId:{type:String,required:!0,index:!0},content:{type:String,default:null},imageFileId:{type:a().Schema.Types.ObjectId,ref:"File",default:null},videoFileId:{type:a().Schema.Types.ObjectId,ref:"File",default:null},authorId:{type:String,required:!0},isAnonymous:{type:Boolean,default:!0},timestamp:{type:Date,default:Date.now,index:!0}},{timestamps:!0}),s=new(a()).Schema({id:{type:String,required:!0,unique:!0},slug:{type:String,required:!0,unique:!0,index:!0},title:{type:String,required:!0},opPostId:{type:String,required:!0},authorId:{type:String,required:!0},replyCount:{type:Number,default:0},imageCount:{type:Number,default:0},videoCount:{type:Number,default:0},lastActivity:{type:Date,default:Date.now,index:!0},createdAt:{type:Date,default:Date.now,index:!0}},{timestamps:!0}),u=new(a()).Schema({filename:{type:String,required:!0},contentType:{type:String,required:!0},size:{type:Number,required:!0},uploadedAt:{type:Date,default:Date.now,index:!0},uploadedBy:{type:String,required:!0},gridFSFileId:{type:a().Schema.Types.ObjectId,required:!0},isDeleted:{type:Boolean,default:!1}},{timestamps:!0}),d=new(a()).Schema({walletAddress:{type:String,required:!0,unique:!0,index:!0},username:{type:String,default:null,maxlength:50},location:{type:String,default:null,maxlength:100},socialLinks:{x:{type:String,default:null},youtube:{type:String,default:null}},bio:{type:String,default:null,maxlength:500},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}},{timestamps:!0}),l=new(a()).Schema({walletAddress:{type:String,required:!0,unique:!0,index:!0},addedBy:{type:String,required:!0},addedAt:{type:Date,default:Date.now}},{timestamps:!0}),p=a().models.User||a().model("User",i),c=a().models.Thread||a().model("Thread",s),m=a().models.Post||a().model("Post",o),f=a().models.File||a().model("File",u),y=a().models.UserProfile||a().model("UserProfile",d),w=a().models.Mod||a().model("Mod",l)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9276,5972,5395],()=>r(66214));module.exports=n})();