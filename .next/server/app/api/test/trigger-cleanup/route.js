"use strict";(()=>{var e={};e.id=9898,e.ids=[9898],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84861:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>y,patchFetch:()=>w,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var r={};o.r(r),o.d(r,{GET:()=>c,POST:()=>u,dynamic:()=>i});var a=o(49303),n=o(88716),s=o(60670),l=o(87070),d=o(67097);let i="force-dynamic";async function u(e){try{console.log("\uD83E\uDDEA TEST: Creating thread 101 to trigger cleanup...");let e=(await (0,d.Oo)()).threads.length;if(console.log(`Current thread count: ${e}`),e<100)return l.NextResponse.json({success:!1,message:`Cannot trigger cleanup - only ${e} threads exist (need 100)`,currentCount:e,needed:100-e});let t=`cleanup_test_thread_${Date.now()}`,o="Thread 101 - Cleanup Test Thread",r={id:t,slug:"cleanup-test-thread",title:o,op:{content:"This is thread 101 created to test the cleanup logic. The oldest thread should be removed when this thread is created.",authorWallet:"test_wallet_address",timestamp:new Date},replyCount:0,imageCount:0,videoCount:0,createdAt:new Date,lastActivity:new Date,authorWallet:"test_wallet_address"};console.log("Creating thread 101..."),await (0,d.gK)(r);let a=await (0,d.Oo)(),n=a.threads.length;return console.log(`ðŸŽ¯ CLEANUP TEST COMPLETE:`),console.log(`ðŸ“Š Thread count before: ${e}`),console.log(`ðŸ“Š Thread count after: ${n}`),console.log(`ðŸ§¹ Cleanup triggered: ${e>n?"YES":"NO"}`),console.log(`ðŸ“‹ Top 5 threads after cleanup:`),a.threads.slice(0,5).forEach((e,t)=>{console.log(`  ${t+1}. ${e.title} (${e.id})`)}),a.threads.length>5&&(console.log(`ðŸ“‹ Bottom 5 threads (oldest):`),a.threads.slice(-5).forEach((e,t)=>{let o=a.threads.length-4+t;console.log(`  ${o}. ${e.title} (${e.id})`)})),l.NextResponse.json({success:!0,message:"Thread 101 created successfully",cleanup:{triggered:e>n,threadsBefore:e,threadsAfter:n,threadsRemoved:e-n},newThread:{id:t,title:o,position:1},topThreads:a.threads.slice(0,5).map((e,t)=>({position:t+1,id:e.id,title:e.title}))})}catch(e){return console.error("Cleanup test error:",e),l.NextResponse.json({success:!1,error:"Failed to trigger cleanup test",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function c(){try{let e=await (0,d.Oo)();return l.NextResponse.json({success:!0,status:{totalThreads:e.threads.length,maxThreads:100,atLimit:e.threads.length>=100,canTriggerCleanup:e.threads.length>=100,oldestThread:e.threads[e.threads.length-1]||null,newestThread:e.threads[0]||null}})}catch(e){return console.error("Error getting cleanup status:",e),l.NextResponse.json({success:!1,error:"Failed to get cleanup status"},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/test/trigger-cleanup/route",pathname:"/api/test/trigger-cleanup",filename:"route",bundlePath:"app/api/test/trigger-cleanup/route"},resolvedPagePath:"/Users/meneer.groot/GitHub/LOOPCHAN/app/api/test/trigger-cleanup/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:p,serverHooks:m}=h,y="/api/test/trigger-cleanup/route";function w(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}},67097:(e,t,o)=>{o.d(t,{G8:()=>l,Ij:()=>s,Oo:()=>a,gK:()=>n});let r={threads:[],totalThreads:0,lastUpdated:new Date().toISOString()};async function a(){try{return console.log("Loading all threads from memory..."),console.log(`âœ… Loaded ${r.threads.length} threads from memory`),r}catch(e){return console.error("Error loading threads:",e),{threads:[],totalThreads:0,lastUpdated:new Date().toISOString()}}}async function n(e){try{console.log("Creating thread with data:",{id:e.id,title:e.title,slug:e.slug}),r.threads.unshift({id:e.id,slug:e.slug,title:e.title,createdAt:e.createdAt.toISOString(),lastActivity:e.lastActivity.toISOString(),replyCount:e.replyCount,imageCount:e.imageCount,videoCount:e.videoCount,op:{content:e.op.content,image:e.op.image,video:e.op.video,authorWallet:e.op.authorWallet,timestamp:e.op.timestamp.toISOString()},authorWallet:e.authorWallet}),console.log(`ðŸ“Œ NEW THREAD: "${e.title}" added to TOP of board (position 0)`),console.log(`Board now has ${r.threads.length} threads`),r.threads.length>100&&(console.log(`ðŸ§¹ CLEANUP: Removing ${r.threads.length-100} old threads (threads 101+)...`),r.threads=r.threads.slice(0,100),console.log(`âœ… CLEANUP: Removed old threads. Board now has ${r.threads.length} threads (max 100)`)),r.totalThreads=r.threads.length,r.lastUpdated=new Date().toISOString(),console.log("âœ… Thread created successfully in memory")}catch(e){throw console.error("Error creating thread:",e),console.error("Error details:",{message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0}),e}}async function s(e){try{console.log(`Loading thread by ID: ${e}`);let t=r.threads.find(t=>t.id===e);if(!t)return console.log(`Thread ${e} not found`),null;let o={id:t.id,slug:t.slug,title:t.title,op:{content:"Thread content would be loaded here",authorWallet:"unknown",timestamp:new Date(t.createdAt)},replyCount:t.replyCount,imageCount:t.imageCount,videoCount:t.videoCount,createdAt:new Date(t.createdAt),lastActivity:new Date(t.lastActivity),authorWallet:"unknown"};return console.log(`âœ… Found thread: ${o.title}`),o}catch(t){return console.error(`Error loading thread ${e}:`,t),null}}async function l(e){try{console.log(`Loading thread by slug: ${e}`);let t=r.threads.find(t=>t.slug===e);if(!t)return console.log(`Thread with slug ${e} not found`),null;let o={id:t.id,slug:t.slug,title:t.title,op:{content:"Thread content would be loaded here",authorWallet:"unknown",timestamp:new Date(t.createdAt)},replyCount:t.replyCount,imageCount:t.imageCount,videoCount:t.videoCount,createdAt:new Date(t.createdAt),lastActivity:new Date(t.lastActivity),authorWallet:"unknown"};return console.log(`âœ… Found thread: ${o.title}`),{thread:o,comments:[]}}catch(t){return console.error(`Error loading thread ${e}:`,t),null}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[9276,5972],()=>o(84861));module.exports=r})();