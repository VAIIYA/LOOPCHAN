"use strict";(()=>{var e={};e.id=442,e.ids=[442],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47546:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>h,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>f,staticGenerationAsyncStorage:()=>y});var n={};r.r(n),r.d(n,{GET:()=>d,PUT:()=>p,dynamic:()=>u});var a=r(49303),i=r(88716),o=r(60670),s=r(87070),l=r(60255);let u="force-dynamic";async function d(e){try{let{searchParams:t}=new URL(e.url),r=t.get("walletAddress");if(!r)return s.NextResponse.json({error:"Wallet address is required"},{status:400});let n=await (0,l.et)(r);return s.NextResponse.json({success:!0,profile:n})}catch(e){return console.error("Get profile error:",e),s.NextResponse.json({error:"Failed to get profile"},{status:500})}}async function p(e){try{let{walletAddress:t,username:r,location:n,socialLinks:a,bio:i}=await e.json();if(!t)return s.NextResponse.json({error:"Wallet address is required"},{status:400});let o=await (0,l.Lj)(t,{walletAddress:t,username:r,location:n,socialLinks:a,bio:i});return s.NextResponse.json({success:!0,profile:o})}catch(t){console.error("Update profile error:",t);let e=t instanceof Error?t.message:"Failed to update profile";if(e.includes("already taken")||e.includes("must be")||e.includes("Invalid"))return s.NextResponse.json({error:e},{status:400});return s.NextResponse.json({error:"Failed to update profile"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/profile/route",pathname:"/api/profile",filename:"route",bundlePath:"app/api/profile/route"},resolvedPagePath:"/Users/meneer.groot/GitHub/LOOPCHAN/app/api/profile/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:y,serverHooks:f}=c,w="/api/profile/route";function h(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:y})}},75637:(e,t,r)=>{r.r(t),r.d(t,{File:()=>y,Mod:()=>w,Post:()=>m,Thread:()=>c,User:()=>p,UserProfile:()=>f});var n=r(11185),a=r.n(n);let i=new(a()).Schema({email:{type:String,required:!0,unique:!0,lowercase:!0,trim:!0},password:{type:String,required:!0},name:{type:String,default:"Anonymous"},createdAt:{type:Date,default:Date.now}},{timestamps:!0}),o=new(a()).Schema({id:{type:String,required:!0,unique:!0},threadId:{type:String,required:!0,index:!0},content:{type:String,default:null},imageFileId:{type:a().Schema.Types.ObjectId,ref:"File",default:null},videoFileId:{type:a().Schema.Types.ObjectId,ref:"File",default:null},authorId:{type:String,required:!0},isAnonymous:{type:Boolean,default:!0},timestamp:{type:Date,default:Date.now,index:!0}},{timestamps:!0}),s=new(a()).Schema({id:{type:String,required:!0,unique:!0},slug:{type:String,required:!0,unique:!0,index:!0},title:{type:String,required:!0},opPostId:{type:String,required:!0},authorId:{type:String,required:!0},replyCount:{type:Number,default:0},imageCount:{type:Number,default:0},videoCount:{type:Number,default:0},lastActivity:{type:Date,default:Date.now,index:!0},createdAt:{type:Date,default:Date.now,index:!0}},{timestamps:!0}),l=new(a()).Schema({filename:{type:String,required:!0},contentType:{type:String,required:!0},size:{type:Number,required:!0},uploadedAt:{type:Date,default:Date.now,index:!0},uploadedBy:{type:String,required:!0},gridFSFileId:{type:a().Schema.Types.ObjectId,required:!0},isDeleted:{type:Boolean,default:!1}},{timestamps:!0}),u=new(a()).Schema({walletAddress:{type:String,required:!0,unique:!0,index:!0},username:{type:String,default:null,maxlength:50},location:{type:String,default:null,maxlength:100},socialLinks:{x:{type:String,default:null},youtube:{type:String,default:null}},bio:{type:String,default:null,maxlength:500},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}},{timestamps:!0}),d=new(a()).Schema({walletAddress:{type:String,required:!0,unique:!0,index:!0},addedBy:{type:String,required:!0},addedAt:{type:Date,default:Date.now}},{timestamps:!0}),p=a().models.User||a().model("User",i),c=a().models.Thread||a().model("Thread",s),m=a().models.Post||a().model("Post",o),y=a().models.File||a().model("File",l),f=a().models.UserProfile||a().model("UserProfile",u),w=a().models.Mod||a().model("Mod",d)},60255:(e,t,r)=>{r.d(t,{Lj:()=>u,U8:()=>l,et:()=>s});var n=r(75637),a=r(11185),i=r.n(a);async function o(){if(!i().connections[0].readyState){if(!process.env.MONGODB_URI)throw Error("MONGODB_URI is not defined");await i().connect(process.env.MONGODB_URI)}}async function s(e){await o();let t=await n.UserProfile.findOne({walletAddress:e}).lean();return t?{walletAddress:t.walletAddress,username:t.username||null,location:t.location||null,socialLinks:{x:t.socialLinks?.x||null,youtube:t.socialLinks?.youtube||null},bio:t.bio||null}:{walletAddress:e,username:null,location:null,socialLinks:{x:null,youtube:null},bio:null}}async function l(e){await o();let t=await n.UserProfile.find({walletAddress:{$in:e}}).lean(),r=new Map;return t.forEach(e=>{r.set(e.walletAddress,{walletAddress:e.walletAddress,username:e.username||null,location:e.location||null,socialLinks:{x:e.socialLinks?.x||null,youtube:e.socialLinks?.youtube||null},bio:e.bio||null})}),e.map(e=>r.get(e)||{walletAddress:e,username:null,location:null,socialLinks:{x:null,youtube:null},bio:null})}async function u(e,t){if(await o(),void 0!==t.username){if(t.username&&t.username.length>50)throw Error("Username must be 50 characters or less");if(t.username&&await n.UserProfile.findOne({username:t.username,walletAddress:{$ne:e}}))throw Error("Username is already taken")}if(void 0!==t.location&&t.location&&t.location.length>100)throw Error("Location must be 100 characters or less");if(void 0!==t.bio&&t.bio&&t.bio.length>500)throw Error("Bio must be 500 characters or less");if(t.socialLinks){if(t.socialLinks.x&&!d(t.socialLinks.x,["x.com","twitter.com"]))throw Error("Invalid X.com URL");if(t.socialLinks.youtube&&!d(t.socialLinks.youtube,["youtube.com","youtu.be"]))throw Error("Invalid YouTube URL")}return await n.UserProfile.findOneAndUpdate({walletAddress:e},{...t,walletAddress:e,updatedAt:new Date},{upsert:!0,new:!0,setDefaultsOnInsert:!0})}function d(e,t){try{let r=new URL(e.startsWith("http")?e:`https://${e}`).hostname.toLowerCase();return t.some(e=>r===e||r.endsWith(`.${e}`))}catch{return!1}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9276,5972],()=>r(47546));module.exports=n})();