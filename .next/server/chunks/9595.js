"use strict";exports.id=9595,exports.ids=[9595],exports.modules={88517:(r,e,t)=>{t.d(e,{_g:()=>a,rf:()=>o});var n=t(49788);async function o(r,e,t){try{console.log(`Uploading buffer ${e} to Cloudinary...`),console.log("Buffer size:",r.length,"MIME type:",t);let o=await new Promise((t,o)=>{n.v2.uploader.upload_stream({public_id:`loopchan/${e}`,resource_type:"raw",folder:"loopchan",use_filename:!0,unique_filename:!0},(r,e)=>{r?(console.error("Cloudinary upload error:",r),o(r)):(console.log("Cloudinary upload success:",e),t(e))}).end(r)});if(o&&"object"==typeof o&&"secure_url"in o)return{success:!0,url:o.secure_url,publicId:o.public_id,fileName:e};throw Error("Invalid upload response from Cloudinary")}catch(r){throw console.error("Cloudinary buffer upload error:",r),r}}async function a(){try{if(console.log("Loading threads data from Cloudinary..."),!process.env.CLOUDINARY_CLOUD_NAME)return console.warn("Cloudinary is not configured, returning empty data"),{threads:[],maxThreads:100,createdAt:new Date().toISOString(),lastUpdated:new Date().toISOString()};try{console.log("Attempting to load threads.json from Cloudinary...");let r=await n.v2.api.resource("loopchan/threads.json");if(console.log("Cloudinary API result:",r),r&&r.secure_url){console.log("Fetching data from URL:",r.secure_url);let e=await fetch(r.secure_url),t=await e.json();return console.log("Loaded threads data from Cloudinary:",t),t}}catch(r){console.error("Failed to download threads data from Cloudinary:",r)}return console.log("No valid threads data found, returning empty data"),{threads:[],maxThreads:100,createdAt:new Date().toISOString(),lastUpdated:new Date().toISOString()}}catch(r){return console.error("Error loading threads data from Cloudinary:",r),{threads:[],maxThreads:100,createdAt:new Date().toISOString(),lastUpdated:new Date().toISOString()}}}n.v2.config({cloud_name:process.env.CLOUDINARY_CLOUD_NAME,api_key:process.env.CLOUDINARY_API_KEY,api_secret:process.env.CLOUDINARY_API_SECRET})},39595:(r,e,t)=>{t.d(e,{BV:()=>y,NE:()=>s,XW:()=>f,ku:()=>g,lJ:()=>i,nI:()=>p,o4:()=>l});var n=t(88517);let o=["2Z9eW3nwa2GZUM1JzXdfBK1MN57RPA2PrhuTREEZ31VY"];async function a(r){try{if(o.includes(r))return!0;return(await i()).includes(r)}catch(r){return console.error("Error checking free wallet status:",r),!1}}async function i(){try{if(!process.env.CLOUDINARY_CLOUD_NAME)return console.error("Cloudinary not configured"),o;try{return o}catch(r){return console.error("Error getting free wallets:",r),o}}catch(r){return console.error("Error getting free wallets:",r),o}}async function c(r){try{if(!process.env.CLOUDINARY_CLOUD_NAME)throw Error("Cloudinary not configured");let e={wallets:r,lastUpdated:new Date().toISOString()},t=Buffer.from(JSON.stringify(e),"utf8");await (0,n.rf)(t,"free_wallets.json","application/json")}catch(r){throw console.error("Error saving free wallets:",r),r}}async function s(r){try{let e=await i();e.includes(r)||(e.push(r),await c(e))}catch(r){throw console.error("Error adding free wallet:",r),r}}async function l(r){try{let e=(await i()).filter(e=>e!==r);await c(e)}catch(r){throw console.error("Error removing free wallet:",r),r}}async function u(r){try{let e=await d(r);if(!e)return!1;if("free"===e.type)return!0;if("paid"===e.type&&e.endDate){let r=new Date(e.endDate),t=new Date;return r>t&&e.isActive}return!1}catch(r){return console.error("Error checking subscription status:",r),!1}}async function d(r){try{if(await a(r))return{walletAddress:r,type:"free",startDate:new Date().toISOString(),isActive:!0};if(!process.env.CLOUDINARY_CLOUD_NAME)return console.error("Cloudinary not configured"),null;try{return null}catch(r){return null}}catch(r){return console.error("Error getting subscription:",r),null}}async function f(r,e=.99){try{let t=new Date,o=new Date(t.getTime()+26784e5),a={walletAddress:r,type:"paid",startDate:t.toISOString(),endDate:o.toISOString(),paymentAmount:e,isActive:!0};if(!process.env.CLOUDINARY_CLOUD_NAME)throw Error("Cloudinary not configured");let i=[];try{i=[]}catch(r){i=[]}let c=i.findIndex(e=>e.walletAddress===r);c>=0?i[c]=a:i.push(a);let s={subscriptions:i,lastUpdated:new Date().toISOString()},l=Buffer.from(JSON.stringify(s),"utf8");return await (0,n.rf)(l,"paid_subscriptions.json","application/json"),a}catch(r){throw console.error("Error creating subscription:",r),r}}async function p(){try{return process.env.CLOUDINARY_CLOUD_NAME||console.error("Cloudinary not configured"),[]}catch(r){return console.error("Error getting all subscriptions:",r),[]}}async function y(r){try{if(await a(r))return!0;return await u(r)}catch(r){return console.error("Error checking reply permission:",r),!1}}async function g(r){try{if(await a(r))return{canReply:!0,type:"free"};let e=await d(r);if(e&&"paid"===e.type&&e.endDate){let r=new Date(e.endDate),t=new Date,n=Math.ceil((r.getTime()-t.getTime())/864e5);return{canReply:n>0&&e.isActive,type:"paid",daysRemaining:Math.max(0,n),endDate:e.endDate}}return{canReply:!1,type:"none"}}catch(r){return console.error("Error getting subscription status:",r),{canReply:!1,type:"none"}}}}};