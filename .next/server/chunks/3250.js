"use strict";exports.id=3250,exports.ids=[3250],exports.modules={87130:(e,t,r)=>{r.d(t,{s:()=>u});var a=r(10326),o=r(17577),s=r(63685),i=r(49758),n=r(71709),l=r(94019),d=r(69436),c=r(31556);let u=({isReply:e=!1,onSubmit:t,onCancel:r})=>{let{wallet:u,connect:p}=(0,c.O)(),[m,g]=(0,o.useState)(""),[h,y]=(0,o.useState)(""),[f,x]=(0,o.useState)(null),[b,w]=(0,o.useState)(!1),S=async r=>{if(r.preventDefault(),!u.connected||!u.publicKey){alert("Please connect your Solana wallet to post");try{await p()}catch(e){console.error("Failed to connect wallet:",e)}return}if(e){if(!m?.trim()&&!f){alert("Please provide either a comment, image, or video");return}}else{if(!h.trim()){alert("Please provide a thread title");return}if(!m?.trim()&&!f){alert("Please provide either a comment, image, or video");return}}w(!0);try{try{await t({content:m.trim()||null,title:e?null:h.trim()||null,image:f?.type.startsWith("image/")?f:null,video:f?.type.startsWith("video/")?f:null})}catch(e){throw console.error("Error in onSubmit callback:",e),e}g(""),y(""),x(null)}catch(e){console.error("Failed to submit post:",e),alert("Failed to submit post. Please try again.")}finally{w(!1)}};return u.connected&&u.publicKey?(0,a.jsxs)("div",{className:"bg-white border border-orange-200 rounded-lg p-6 shadow-md",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:e?"Post Reply":"Start New Thread"}),r&&a.jsx("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 transition-colors",children:a.jsx(l.Z,{size:20})})]}),(0,a.jsxs)("form",{onSubmit:S,className:"space-y-4",children:[!e&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Subject"}),a.jsx("input",{type:"text",value:h,onChange:e=>y(e.target.value),placeholder:"Thread title...",className:"w-full bg-orange-50 border border-orange-300 rounded-lg px-3 py-2 text-gray-800 placeholder-gray-500 focus:border-orange-500 focus:ring-1 focus:ring-orange-500 outline-none",style:{fontSize:"16px"},required:!0})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Comment"}),a.jsx("textarea",{value:m,onChange:e=>g(e.target.value),placeholder:"Type your message here... (optional)",rows:6,className:"w-full bg-orange-50 border border-orange-300 rounded-lg px-3 py-2 text-gray-800 placeholder-gray-500 focus:border-orange-500 focus:ring-1 focus:ring-orange-500 outline-none resize-none",style:{fontSize:"16px"}})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:(()=>{if(!f)return"Media (optional)";let e=f.type.startsWith("video/");return`${e?"Video":"Image"} (${f.name})`})()}),a.jsx("div",{className:"flex space-x-2",children:(0,a.jsxs)("div",{className:"flex-1 relative",children:[a.jsx("input",{type:"file",accept:".jpg,.jpeg,.png,.gif,.webp,.webm,.mp4,.mov,video/webm,video/mp4,video/quicktime,image/jpeg,image/png,image/gif,image/webp",capture:"environment",onChange:e=>{try{let t=e.target.files?.[0];if(t){let e=["video/webm","video/mp4","video/quicktime"];if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp",...e].includes(t.type)){alert("File type not allowed. Please select a JPG, PNG, GIF, WebP image or WebM/MP4/MOV video.");return}let r=e.includes(t.type),a=r?10485760:5242880;if(t.size>a){alert(`File too large. Maximum size for ${r?"videos":"images"}: ${a/1048576}MB`);return}x(t)}}catch(e){console.error("Error handling file change:",e),alert("Error processing file. Please try again.")}},className:"w-full bg-orange-50 border border-orange-300 rounded-lg px-3 py-2 text-gray-800 placeholder-gray-500 focus:border-orange-500 focus:ring-1 focus:ring-orange-500 outline-none",style:{fontSize:"16px"}}),a.jsx("div",{className:"absolute right-3 top-2.5 text-orange-400",children:f?f.type.startsWith("video/")?a.jsx(i.Z,{size:18}):a.jsx(n.Z,{size:18}):a.jsx(s.Z,{size:18})})]})}),a.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"Images: JPG, PNG, GIF, WebP (max 5MB) | Videos: WebM, MP4, MOV (max 10MB)"}),f&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-green-600",children:["Selected: ",f.name," (",(f.size/1048576).toFixed(2),"MB)"]})]}),a.jsx("div",{className:"flex justify-end",children:(0,a.jsxs)("button",{type:"submit",disabled:!m?.trim()&&!f||!e&&!h.trim()||b,className:"flex items-center space-x-2 bg-gradient-to-r from-orange-500 to-pink-500 hover:from-orange-600 hover:to-pink-600 disabled:from-gray-400 disabled:to-gray-400 disabled:cursor-not-allowed text-white px-6 py-3 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg min-h-[44px] touch-manipulation",style:{fontSize:"16px"},children:[a.jsx(d.Z,{size:18}),a.jsx("span",{children:b?"Posting...":e?"Post Reply":"Create Thread"})]})})]})]}):a.jsx("div",{className:"bg-white border border-orange-200 rounded-lg p-6 shadow-md",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Wallet Connection Required"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"You need to connect your Solana wallet to create threads and post replies."}),a.jsx("button",{onClick:p,disabled:u.connecting,className:"bg-gradient-to-r from-orange-500 to-pink-500 hover:from-orange-600 hover:to-pink-600 disabled:from-gray-400 disabled:to-gray-400 text-white px-6 py-2 rounded-lg",children:u.connecting?"Connecting...":"Connect Wallet"})]})})}},14829:(e,t,r)=>{r.d(t,{J:()=>m});var a=r(17577),o=r(31556),s=r(11185),i=r.n(s);let n=new(i()).Schema({email:{type:String,required:!0,unique:!0,lowercase:!0,trim:!0},password:{type:String,required:!0},name:{type:String,default:"Anonymous"},createdAt:{type:Date,default:Date.now}},{timestamps:!0}),l=new(i()).Schema({id:{type:String,required:!0,unique:!0},threadId:{type:String,required:!0,index:!0},content:{type:String,default:null},imageFileId:{type:i().Schema.Types.ObjectId,ref:"File",default:null},videoFileId:{type:i().Schema.Types.ObjectId,ref:"File",default:null},authorId:{type:String,required:!0},isAnonymous:{type:Boolean,default:!0},timestamp:{type:Date,default:Date.now,index:!0}},{timestamps:!0}),d=new(i()).Schema({id:{type:String,required:!0,unique:!0},slug:{type:String,required:!0,unique:!0,index:!0},title:{type:String,required:!0},opPostId:{type:String,required:!0},authorId:{type:String,required:!0},replyCount:{type:Number,default:0},imageCount:{type:Number,default:0},videoCount:{type:Number,default:0},lastActivity:{type:Date,default:Date.now,index:!0},createdAt:{type:Date,default:Date.now,index:!0}},{timestamps:!0}),c=new(i()).Schema({filename:{type:String,required:!0},contentType:{type:String,required:!0},size:{type:Number,required:!0},uploadedAt:{type:Date,default:Date.now,index:!0},uploadedBy:{type:String,required:!0},gridFSFileId:{type:i().Schema.Types.ObjectId,required:!0},isDeleted:{type:Boolean,default:!1}},{timestamps:!0}),u=new(i()).Schema({walletAddress:{type:String,required:!0,unique:!0,index:!0},username:{type:String,default:null,maxlength:50},location:{type:String,default:null,maxlength:100},socialLinks:{x:{type:String,default:null},youtube:{type:String,default:null}},bio:{type:String,default:null,maxlength:500},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}},{timestamps:!0}),p=new(i()).Schema({walletAddress:{type:String,required:!0,unique:!0,index:!0},addedBy:{type:String,required:!0},addedAt:{type:Date,default:Date.now}},{timestamps:!0});i().models.User||i().model("User",n),i().models.Thread||i().model("Thread",d),i().models.Post||i().model("Post",l),i().models.File||i().model("File",c),i().models.UserProfile||i().model("UserProfile",u),i().models.Mod||i().model("Mod",p);let m=()=>{let{wallet:e}=(0,o.O)(),[t,s]=(0,a.useState)({isProcessing:!1,isVerifying:!1,error:null,success:!1,transactionSignature:null});return{paymentState:t,processPayment:(0,a.useCallback)(async()=>{if(!e.connected||!e.publicKey)return s(e=>({...e,error:"Please connect your wallet first"})),null;s({isProcessing:!0,isVerifying:!1,error:null,success:!1,transactionSignature:null});try{let t=await fetch("/api/payments/posting-fee",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromWallet:e.publicKey.toString()})}),a=await t.json();if(!t.ok||!a.success||!a.transaction)throw Error(a.error||"Failed to create payment transaction");let o=Buffer.from(a.transaction,"base64");throw r(68521).YW.from(o),Error("Solana wallet not available")}catch(e){return console.error("Payment error:",e),s(t=>({...t,isProcessing:!1,isVerifying:!1,error:e instanceof Error?e.message:"Payment failed",success:!1})),null}},[e]),resetPaymentState:(0,a.useCallback)(()=>{s({isProcessing:!1,isVerifying:!1,error:null,success:!1,transactionSignature:null})},[]),postingFee:.01}}},51471:(e,t,r)=>{r.d(t,{s:()=>a});class a{static async uploadFile(e,t){try{let r=new FormData;r.append("file",e),r.append("authorWallet",t);let a=await fetch("/api/upload",{method:"POST",body:r});if(!a.ok){let e=await a.json().catch(()=>({error:"Upload failed"}));throw Error(e.error||"Failed to upload file")}let o=await a.json();return console.log("File upload successful:",o),o}catch(e){throw console.error("File upload failed:",e),e}}static async createThread(e){console.log("Creating thread:",e);try{let t=await fetch("/api/threads",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(console.log("Thread creation response status:",t.status),!t.ok){let e=await t.json().catch(()=>({error:"Failed to create thread"}));throw console.error("Thread creation error:",e),console.error("Response status:",t.status),console.error("Response headers:",Object.fromEntries(t.headers.entries())),Error(e.error||"Failed to create thread")}let r=await t.json();if(console.log("Thread creation result:",r),!r.success||!r.thread)throw console.error("Invalid thread creation result:",r),Error("Invalid response from server");return r}catch(e){throw console.error("Thread creation request failed:",e),e}}static async getThreads(e=1){console.log("Fetching threads, page:",e);try{let t=await fetch(`/api/threads?page=${e}`);if(!t.ok)return console.error("Failed to get threads, status:",t.status),{threads:[],page:e,totalPages:0,totalThreads:0};let r=await t.json();return console.log("Threads result:",r),r}catch(t){return console.error("Get threads request failed:",t),{threads:[],page:e,totalPages:0,totalThreads:0}}}static async createPost(e){console.log("Creating post:",e);let t=await fetch(`/api/threads/${e.threadId}/posts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to create post"}))).error||"Failed to create post");return t.json()}static async getThread(e){try{let t=await fetch(`/api/threads/${e}`,{cache:"no-store",headers:{"Cache-Control":"no-cache"}});if(!t.ok){if(404===t.status)return{success:!1,error:"Thread not found"};let e=await t.json().catch(()=>({error:"Failed to get thread"}));return{success:!1,error:e.error||"Failed to get thread"}}return await t.json()}catch(e){return{success:!1,error:"Failed to load thread"}}}}}};