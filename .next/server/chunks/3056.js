"use strict";exports.id=3056,exports.ids=[3056],exports.modules={79635:(e,t,s)=>{s.d(t,{Z:()=>a});let a=(0,s(76557).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},83056:(e,t,s)=>{s.d(t,{s:()=>w});var a=s(10326),l=s(17577),r=s(76557);let i=(0,r.Z)("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);var n=s(37358);let o=(0,r.Z)("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),d=(0,r.Z)("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),c=(0,r.Z)("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),p=(0,r.Z)("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),m=(0,r.Z)("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);var u=s(94019);let x=({post:e,isOP:t=!1})=>{let[s,r]=(0,l.useState)(!1),[x,h]=(0,l.useState)(!1),[g,y]=(0,l.useState)(null),[b,j]=(0,l.useState)(!1),f=()=>{j(!b)};try{return(0,a.jsxs)("div",{className:`${t?"bg-orange-50 border-orange-300":"bg-white border-orange-200"} border rounded-lg p-4 mb-4 shadow-sm`,children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4 mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-orange-500",children:[a.jsx(i,{size:14}),a.jsx("span",{className:"font-mono",children:e.id})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[a.jsx(n.Z,{size:14}),a.jsx("span",{children:(e=>{try{if(null==e)return"No date";let t="string"==typeof e?new Date(e):e;if(isNaN(t.getTime()))return console.warn("Invalid date value:",e),"Invalid date";return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)}catch(t){return console.error("Error formatting date:",t,e),"Invalid date"}})(e.timestamp)})]}),a.jsx("div",{className:"flex items-center space-x-1 text-sm text-gray-600",children:a.jsx("span",{className:"font-medium",children:e.authorDisplayName||(e.isAnonymous?"Anonymous":e.authorWallet?`${e.authorWallet.slice(0,8)}...`:"Unknown")})}),t&&a.jsx("span",{className:"bg-gradient-to-r from-orange-500 to-pink-500 text-white text-xs px-2 py-1 rounded",children:"OP"})]}),(e.image||e.video)&&(0,a.jsxs)("div",{className:"w-full mb-4",children:[e.image&&(0,a.jsxs)("div",{className:"relative flex justify-center",children:[a.jsx("img",{src:e.imageThumb||e.image,alt:"Post image",className:"max-w-full h-auto rounded-lg cursor-pointer hover:opacity-80 transition-opacity",style:{maxHeight:"600px",maxWidth:"100%",objectFit:"contain"},onClick:f}),a.jsx("button",{onClick:f,className:"absolute top-2 right-2 bg-black bg-opacity-50 text-white p-1 rounded hover:bg-opacity-70 transition-all",title:"Click to expand",children:a.jsx(o,{size:14})})]}),e.video&&!e.image&&(0,a.jsxs)("div",{className:"relative flex justify-center bg-gray-900 rounded-lg overflow-hidden",children:[a.jsx("video",{ref:y,src:e.video,className:"max-w-full h-auto rounded-lg",style:{maxHeight:"600px",maxWidth:"100%",objectFit:"contain"},onEnded:()=>{r(!1)},muted:x,loop:!0}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:a.jsx("button",{onClick:()=>{g&&(s?g.pause():g.play(),r(!s))},className:"bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-70 transition-all",children:s?a.jsx(d,{size:16}):a.jsx(c,{size:16})})}),a.jsx("div",{className:"absolute bottom-2 right-2",children:a.jsx("button",{onClick:()=>{g&&(g.muted=!x,h(!x))},className:"bg-black bg-opacity-50 text-white p-1 rounded hover:bg-opacity-70 transition-all",children:x?a.jsx(p,{size:12}):a.jsx(m,{size:12})})}),a.jsx("button",{onClick:()=>{e.video&&window.open(e.video,"_blank")},className:"absolute top-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded hover:bg-opacity-70 transition-all",children:"Open"})]})]}),e.content&&a.jsx("div",{className:"w-full",children:a.jsx("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed",children:e.content})}),b&&e.image&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"relative max-w-4xl max-h-full",children:[a.jsx("img",{src:e.image,alt:"Expanded post image",className:"max-w-full max-h-full object-contain rounded-lg"}),a.jsx("button",{onClick:f,className:"absolute top-4 right-4 bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-70 transition-all",children:a.jsx(u.Z,{size:20})}),a.jsx("a",{href:e.image,download:!0,className:"absolute bottom-4 right-4 bg-black bg-opacity-50 text-white px-3 py-2 rounded hover:bg-opacity-70 transition-all text-sm",target:"_blank",rel:"noopener noreferrer",children:"Download"})]})})]})}catch(t){return console.error("Error rendering PostComponent:",t,e),a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:(0,a.jsxs)("p",{className:"text-red-600",children:["Error displaying post: ",e.id]})})}};var h=s(87130),g=s(86333),y=s(40617),b=s(79635),j=s(31556),f=s(14829),v=s(51471);let w=({thread:e,onBack:t})=>{let[s,r]=(0,l.useState)(!1),[i,n]=(0,l.useState)(e),[o,d]=(0,l.useState)(!1),[c,p]=(0,l.useState)(!1),[m,u]=(0,l.useState)([]),[w,N]=(0,l.useState)(!1),{wallet:k}=(0,j.O)(),{processPayment:C}=(0,f.J)(),S=(0,l.useCallback)(async()=>{try{d(!0),console.log("Refreshing thread data...");let e=`/api/threads/${i.id}/posts`,t=await fetch(e,{cache:"no-store",headers:{"Cache-Control":"no-cache"}});if(t.ok){let e=await t.json();if(e.thread){let t=e.thread;n(e=>{let s=(e.replies||[]).filter(e=>!t.replies.some(t=>t.id===e.id)&&e.id.startsWith("temp_"));return{...t,replies:[...t.replies,...s],replyCount:t.replyCount+s.length}}),console.log("Thread data refreshed successfully with optimistic merge")}else console.error("Failed to refresh thread data: Invalid response structure")}else console.error("Failed to refresh thread data:",t.status)}catch(e){console.error("Error refreshing thread data:",e)}finally{d(!1)}},[i.id,i.slug]),$=(0,l.useCallback)(e=>{let t=`temp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,s={...e,id:t};return n(e=>({...e,replies:[...e.replies||[],s],replyCount:(e.replyCount||0)+1,lastReply:new Date,lastActivity:new Date})),t},[]),P=(0,l.useCallback)(async()=>{for(let e of m.filter(e=>"pending"===e.status))try{u(t=>t.map(t=>t.id===e.id?{...t,status:"uploading"}:t)),console.log(`Processing upload: ${e.id}`),await R(e),u(t=>t.map(t=>t.id===e.id?{...t,status:"completed"}:t)),console.log(`Upload completed: ${e.id}`)}catch(t){console.error(`Upload failed: ${e.id}`,t),u(t=>t.map(t=>t.id===e.id?{...t,status:"failed"}:t)),n(t=>({...t,replies:t.replies.filter(t=>t.id!==e.data.tempId),replyCount:Math.max(0,t.replyCount-1)})),alert(`Failed to create reply: ${t instanceof Error?t.message:"Unknown error"}. Please try again.`)}setTimeout(()=>{u(e=>e.filter(e=>"completed"!==e.status))},5e3)},[m]),R=(0,l.useCallback)(async e=>{let{data:t}=e,s=null,a=null;t.image&&k.publicKey&&console.log("Image uploaded:",s=(await v.s.uploadFile(t.image,k.publicKey)).url),t.video&&k.publicKey&&console.log("Video uploaded:",a=(await v.s.uploadFile(t.video,k.publicKey)).url);let l={content:t.content,image:s,video:a,authorWallet:k.publicKey||"anonymous"};console.log("Creating reply with data:",l),console.log("Sending reply creation request to server...");let r=await fetch(`/api/threads/${i.id}/posts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(402===r.status&&(await r.json()).requiresPayment){console.log("Payment required, processing payment...");let e=await C();if(!e)throw Error("Payment failed or was cancelled");l.paymentSignature=e,r=await fetch(`/api/threads/${i.id}/posts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})}if(!r.ok){let e=await r.json().catch(()=>({error:"Failed to create reply"}));throw console.error("Reply creation error:",e),Error(`HTTP error! status: ${r.status}, message: ${e.error||"Unknown error"}`)}let o=await r.json();if(console.log("Reply created successfully:",o),!o.success||!o.post)throw console.error("Invalid reply creation result:",o),Error("Invalid response from server");console.log(`Updating optimistic reply ${t.tempId} with server data ${o.post.id}`),n(e=>{let l=e.replies.map(e=>e.id===t.tempId?{...e,id:o.post.id,timestamp:new Date(o.post.timestamp),image:s||null,imageThumb:s||null,video:a||null}:e);return console.log(`Thread now has ${l.length} replies after server update`),console.log("Updated reply IDs:",l.map(e=>e.id)),{...e,replies:l,replyCount:e.replyCount,lastReply:new Date,lastActivity:new Date}}),u(t=>t.map(t=>t.id===e.id?{...t,status:"completed"}:t)),console.log(`Upload completed: ${e.id}`),m.map(t=>t.id===e.id?{...t,status:"completed"}:t).every(e=>"completed"===e.status)&&(N(!0),setTimeout(()=>N(!1),3e3))},[k.publicKey,i.id,m]);(0,l.useEffect)(()=>{m.length>0&&P()},[m,P]);let z=(0,l.useCallback)(async e=>{try{if(!k.connected||!k.publicKey){alert("Please connect your Solana wallet to post");return}p(!0);let t={id:"",timestamp:new Date,content:e.content||null,image:e.image?URL.createObjectURL(e.image):null,imageThumb:e.image?URL.createObjectURL(e.image):null,video:e.video?URL.createObjectURL(e.video):null,authorWallet:k.publicKey||"anonymous",isAnonymous:!0},s=$(t),a=`upload_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;u(t=>[...t,{id:a,data:{...e,tempId:s},status:"pending"}]),r(!1)}catch(e){console.error("Failed to create reply:",e),alert("Failed to create reply. Please try again.")}finally{p(!1)}},[k,$]);return i?(0,a.jsxs)("div",{className:"max-w-4xl mx-auto p-6 bg-gradient-to-br from-orange-50 to-pink-50 min-h-screen",children:[w&&a.jsx("div",{className:"fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-in slide-in-from-right duration-300",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx("span",{className:"text-xl",children:"✅"}),a.jsx("span",{children:"Reply posted successfully!"})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("button",{onClick:t,className:"flex items-center space-x-2 text-orange-600 hover:text-orange-700 transition-colors",children:[a.jsx(g.Z,{size:20}),a.jsx("span",{children:"Back"})]}),(0,a.jsxs)("button",{onClick:S,disabled:o,className:"flex items-center space-x-2 text-orange-600 hover:text-orange-700 transition-colors disabled:opacity-50",children:[a.jsx(y.Z,{size:20}),a.jsx("span",{children:o?"Refreshing...":"Refresh"})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[a.jsx("h1",{className:"text-2xl font-bold text-orange-600 mb-4",children:i.title||"Untitled Thread"}),m.length>0&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse"}),a.jsx("span",{className:"text-blue-700 font-medium",children:"Processing Reply"})]}),(0,a.jsxs)("span",{className:"text-blue-600 text-sm",children:[m.filter(e=>"completed"===e.status).length,"/",m.length," completed"]})]}),a.jsx("div",{className:"mt-2 space-y-2",children:m.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:"flex-1 bg-blue-200 rounded-full h-2",children:a.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${"completed"===e.status?"bg-green-500":"uploading"===e.status?"bg-blue-500":"failed"===e.status?"bg-red-500":"bg-blue-300"}`,style:{width:"completed"===e.status?"100%":"uploading"===e.status?"50%":"0%"}})}),a.jsx("span",{className:"text-xs text-blue-600 w-16 text-right",children:"completed"===e.status?"✓":"uploading"===e.status?"⏳":"failed"===e.status?"✗":"⏸️"})]},e.id))}),m.every(e=>"completed"===e.status)&&a.jsx("div",{className:"mt-3 p-2 bg-green-50 border border-green-200 rounded text-center",children:a.jsx("span",{className:"text-green-700 text-sm",children:"✅ Reply posted successfully!"})})]}),i.op?a.jsx(x,{post:i.op,isOP:!0}):a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:a.jsx("p",{className:"text-red-600",children:"Error: Thread OP not found"})})]}),a.jsx("div",{className:"space-y-4",children:Array.isArray(i.replies)?i.replies.map(e=>{try{if(!e||!e.id)return console.warn("Invalid reply data:",e),null;return a.jsx(x,{post:e},e.id)}catch(t){return console.error("Error rendering reply:",t,e),a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,a.jsxs)("p",{className:"text-red-600",children:["Error displaying reply: ",e.id||"unknown"]})},e.id||"unknown")}}):(0,a.jsxs)("div",{className:"text-center py-8",children:[a.jsx(y.Z,{className:"mx-auto text-orange-400 mb-4",size:32}),a.jsx("p",{className:"text-orange-500 mb-6",children:"No replies yet. Be the first to reply!"})]})}),s&&a.jsx("div",{className:"mt-6",children:a.jsx(h.s,{isReply:!0,onSubmit:z,onCancel:()=>r(!1)})}),a.jsx("div",{className:"text-center py-8 border-t border-orange-200 mt-6",children:k.connected&&k.publicKey?(0,a.jsxs)("button",{onClick:()=>r(!s),disabled:c||m.length>0,className:"flex items-center space-x-2 bg-gradient-to-r from-orange-500 to-pink-500 hover:from-orange-600 hover:to-pink-600 text-white px-6 py-3 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg mx-auto disabled:opacity-50",children:[a.jsx(y.Z,{size:18}),a.jsx("span",{children:c?"Posting...":m.length>0?`Uploading (${m.length})`:"Reply"})]}):a.jsx("div",{className:"text-center",children:(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-blue-800 mb-2",children:[a.jsx(b.Z,{size:20}),a.jsx("span",{className:"font-medium",children:"Wallet Connection Required"})]}),a.jsx("p",{className:"text-blue-700 text-sm mb-4",children:"Connect your Solana wallet to reply to threads."})]})})})]}):(console.error("ThreadView: No thread provided"),a.jsx("div",{className:"max-w-4xl mx-auto p-6 bg-gradient-to-br from-orange-50 to-pink-50 min-h-screen",children:a.jsx("div",{className:"text-center py-8",children:a.jsx("p",{className:"text-red-600",children:"Error: No thread data available"})})}))}}};