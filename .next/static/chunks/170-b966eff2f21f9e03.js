(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[170],{6601:function(){},1995:function(e,t,r){"use strict";r.d(t,{s:function(){return u}});var a=r(7437),o=r(2265),i=r(7689),n=r(9374),s=r(3113),l=r(2489),d=r(4743),c=r(6541);let u=e=>{let{isReply:t=!1,onSubmit:r,onCancel:u}=e,{wallet:m,connect:g}=(0,c.O)(),[p,h]=(0,o.useState)(""),[y,f]=(0,o.useState)(""),[x,b]=(0,o.useState)(null),[w,v]=(0,o.useState)(!1),S=async e=>{if(e.preventDefault(),!m.connected||!m.publicKey){alert("Please connect your Solana wallet to post");try{await g()}catch(e){console.error("Failed to connect wallet:",e)}return}if(t){if(!(null==p?void 0:p.trim())&&!x){alert("Please provide either a comment, image, or video");return}}else{if(!y.trim()){alert("Please provide a thread title");return}if(!(null==p?void 0:p.trim())&&!x){alert("Please provide either a comment, image, or video");return}}v(!0);try{try{await r({content:p.trim()||null,title:t?null:y.trim()||null,image:(null==x?void 0:x.type.startsWith("image/"))?x:null,video:(null==x?void 0:x.type.startsWith("video/"))?x:null})}catch(e){throw console.error("Error in onSubmit callback:",e),e}h(""),f(""),b(null)}catch(e){console.error("Failed to submit post:",e),alert("Failed to submit post. Please try again.")}finally{v(!1)}};return m.connected&&m.publicKey?(0,a.jsxs)("div",{className:"bg-white border border-orange-200 rounded-lg p-6 shadow-md",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:t?"Post Reply":"Start New Thread"}),u&&(0,a.jsx)("button",{onClick:u,className:"text-gray-500 hover:text-gray-700 transition-colors",children:(0,a.jsx)(l.Z,{size:20})})]}),(0,a.jsxs)("form",{onSubmit:S,className:"space-y-4",children:[!t&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Subject"}),(0,a.jsx)("input",{type:"text",value:y,onChange:e=>f(e.target.value),placeholder:"Thread title...",className:"w-full bg-orange-50 border border-orange-300 rounded-lg px-3 py-2 text-gray-800 placeholder-gray-500 focus:border-orange-500 focus:ring-1 focus:ring-orange-500 outline-none",style:{fontSize:"16px"},required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Comment"}),(0,a.jsx)("textarea",{value:p,onChange:e=>h(e.target.value),placeholder:"Type your message here... (optional)",rows:6,className:"w-full bg-orange-50 border border-orange-300 rounded-lg px-3 py-2 text-gray-800 placeholder-gray-500 focus:border-orange-500 focus:ring-1 focus:ring-orange-500 outline-none resize-none",style:{fontSize:"16px"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:(()=>{if(!x)return"Media (optional)";let e=x.type.startsWith("video/");return"".concat(e?"Video":"Image"," (").concat(x.name,")")})()}),(0,a.jsx)("div",{className:"flex space-x-2",children:(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)("input",{type:"file",accept:".jpg,.jpeg,.png,.gif,.webp,.webm,.mp4,.mov,video/webm,video/mp4,video/quicktime,image/jpeg,image/png,image/gif,image/webp",capture:"environment",onChange:e=>{try{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){let e=["video/webm","video/mp4","video/quicktime"];if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp",...e].includes(r.type)){alert("File type not allowed. Please select a JPG, PNG, GIF, WebP image or WebM/MP4/MOV video.");return}let t=e.includes(r.type),a=t?10485760:5242880;if(r.size>a){alert("File too large. Maximum size for ".concat(t?"videos":"images",": ").concat(a/1048576,"MB"));return}b(r)}}catch(e){console.error("Error handling file change:",e),alert("Error processing file. Please try again.")}},className:"w-full bg-orange-50 border border-orange-300 rounded-lg px-3 py-2 text-gray-800 placeholder-gray-500 focus:border-orange-500 focus:ring-1 focus:ring-orange-500 outline-none",style:{fontSize:"16px"}}),(0,a.jsx)("div",{className:"absolute right-3 top-2.5 text-orange-400",children:x?x.type.startsWith("video/")?(0,a.jsx)(n.Z,{size:18}):(0,a.jsx)(s.Z,{size:18}):(0,a.jsx)(i.Z,{size:18})})]})}),(0,a.jsx)("div",{className:"mt-2 text-xs text-gray-500",children:"Images: JPG, PNG, GIF, WebP (max 5MB) | Videos: WebM, MP4, MOV (max 10MB)"}),x&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-green-600",children:["Selected: ",x.name," (",(x.size/1048576).toFixed(2),"MB)"]})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("button",{type:"submit",disabled:!(null==p?void 0:p.trim())&&!x||!t&&!y.trim()||w,className:"flex items-center space-x-2 bg-gradient-to-r from-orange-500 to-pink-500 hover:from-orange-600 hover:to-pink-600 disabled:from-gray-400 disabled:to-gray-400 disabled:cursor-not-allowed text-white px-6 py-3 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg min-h-[44px] touch-manipulation",style:{fontSize:"16px"},children:[(0,a.jsx)(d.Z,{size:18}),(0,a.jsx)("span",{children:w?"Posting...":t?"Post Reply":"Create Thread"})]})})]})]}):(0,a.jsx)("div",{className:"bg-white border border-orange-200 rounded-lg p-6 shadow-md",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Wallet Connection Required"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"You need to connect your Solana wallet to create threads and post replies."}),(0,a.jsx)("button",{onClick:g,disabled:m.connecting,className:"bg-gradient-to-r from-orange-500 to-pink-500 hover:from-orange-600 hover:to-pink-600 disabled:from-gray-400 disabled:to-gray-400 text-white px-6 py-2 rounded-lg",children:m.connecting?"Connecting...":"Connect Wallet"})]})})}},3545:function(e,t,r){"use strict";r.d(t,{J:function(){return h}});var a=r(2265),o=r(6541),i=r(5316),n=r.n(i);let s=new(n()).Schema({email:{type:String,required:!0,unique:!0,lowercase:!0,trim:!0},password:{type:String,required:!0},name:{type:String,default:"Anonymous"},createdAt:{type:Date,default:Date.now}},{timestamps:!0}),l=new(n()).Schema({id:{type:String,required:!0,unique:!0},threadId:{type:String,required:!0,index:!0},content:{type:String,default:null},imageFileId:{type:n().Schema.Types.ObjectId,ref:"File",default:null},videoFileId:{type:n().Schema.Types.ObjectId,ref:"File",default:null},authorId:{type:String,required:!0},isAnonymous:{type:Boolean,default:!0},timestamp:{type:Date,default:Date.now,index:!0}},{timestamps:!0}),d=new(n()).Schema({id:{type:String,required:!0,unique:!0},slug:{type:String,required:!0,unique:!0,index:!0},title:{type:String,required:!0},opPostId:{type:String,required:!0},authorId:{type:String,required:!0},replyCount:{type:Number,default:0},imageCount:{type:Number,default:0},videoCount:{type:Number,default:0},lastActivity:{type:Date,default:Date.now,index:!0},createdAt:{type:Date,default:Date.now,index:!0}},{timestamps:!0}),c=new(n()).Schema({filename:{type:String,required:!0},contentType:{type:String,required:!0},size:{type:Number,required:!0},uploadedAt:{type:Date,default:Date.now,index:!0},uploadedBy:{type:String,required:!0},gridFSFileId:{type:n().Schema.Types.ObjectId,required:!0},isDeleted:{type:Boolean,default:!1}},{timestamps:!0}),u=new(n()).Schema({walletAddress:{type:String,required:!0,unique:!0,index:!0},username:{type:String,default:null,maxlength:50},location:{type:String,default:null,maxlength:100},socialLinks:{x:{type:String,default:null},youtube:{type:String,default:null}},bio:{type:String,default:null,maxlength:500},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}},{timestamps:!0}),m=new(n()).Schema({walletAddress:{type:String,required:!0,unique:!0,index:!0},addedBy:{type:String,required:!0},addedAt:{type:Date,default:Date.now}},{timestamps:!0});n().models.User||n().model("User",s),n().models.Thread||n().model("Thread",d),n().models.Post||n().model("Post",l),n().models.File||n().model("File",c),n().models.UserProfile||n().model("UserProfile",u),n().models.Mod||n().model("Mod",m),r(5566);var g=r(2957).Buffer,p=r(5566);let h=()=>{let{wallet:e}=(0,o.O)(),[t,i]=(0,a.useState)({isProcessing:!1,isVerifying:!1,error:null,success:!1,transactionSignature:null});return{paymentState:t,processPayment:(0,a.useCallback)(async()=>{if(!e.connected||!e.publicKey)return i(e=>({...e,error:"Please connect your wallet first"})),null;i({isProcessing:!0,isVerifying:!1,error:null,success:!1,transactionSignature:null});try{let t=await fetch("/api/payments/posting-fee",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromWallet:e.publicKey.toString()})}),a=await t.json();if(!t.ok||!a.success||!a.transaction)throw Error(a.error||"Failed to create payment transaction");let o=g.from(a.transaction,"base64"),n=r(4024).YW.from(o);if("solana"in window){let t=window.solana;if(null==t?void 0:t.isPhantom){let a=await t.signTransaction(n),o=new(r(4024)).ew(p.env.NEXT_PUBLIC_SOLANA_RPC_URL||"https://api.mainnet-beta.solana.com","confirmed"),s=await o.sendRawTransaction(a.serialize(),{skipPreflight:!1,maxRetries:3});i(e=>({...e,isProcessing:!1,isVerifying:!0,transactionSignature:s})),await o.confirmTransaction(s,"confirmed");let l=await fetch("/api/payments/posting-fee?signature=".concat(s,"&fromWallet=").concat(e.publicKey.toString()));if((await l.json()).verified)return i(e=>({...e,isVerifying:!1,success:!0,error:null})),s;throw Error("Payment verification failed")}throw Error("Phantom wallet not available")}throw Error("Solana wallet not available")}catch(e){return console.error("Payment error:",e),i(t=>({...t,isProcessing:!1,isVerifying:!1,error:e instanceof Error?e.message:"Payment failed",success:!1})),null}},[e]),resetPaymentState:(0,a.useCallback)(()=>{i({isProcessing:!1,isVerifying:!1,error:null,success:!1,transactionSignature:null})},[]),postingFee:.01}}},8223:function(e,t,r){"use strict";r.d(t,{s:function(){return a}});class a{static async uploadFile(e,t){try{let r=new FormData;r.append("file",e),r.append("authorWallet",t);let a=await fetch("/api/upload",{method:"POST",body:r});if(!a.ok){let e=await a.json().catch(()=>({error:"Upload failed"}));throw Error(e.error||"Failed to upload file")}let o=await a.json();return console.log("File upload successful:",o),o}catch(e){throw console.error("File upload failed:",e),e}}static async createThread(e){console.log("Creating thread:",e);try{let t=await fetch("/api/threads",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(console.log("Thread creation response status:",t.status),!t.ok){let e=await t.json().catch(()=>({error:"Failed to create thread"}));throw console.error("Thread creation error:",e),console.error("Response status:",t.status),console.error("Response headers:",Object.fromEntries(t.headers.entries())),Error(e.error||"Failed to create thread")}let r=await t.json();if(console.log("Thread creation result:",r),!r.success||!r.thread)throw console.error("Invalid thread creation result:",r),Error("Invalid response from server");return r}catch(e){throw console.error("Thread creation request failed:",e),e}}static async getThreads(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;console.log("Fetching threads, page:",e);try{let t=await fetch("/api/threads?page=".concat(e));if(!t.ok)return console.error("Failed to get threads, status:",t.status),{threads:[],page:e,totalPages:0,totalThreads:0};let r=await t.json();return console.log("Threads result:",r),r}catch(t){return console.error("Get threads request failed:",t),{threads:[],page:e,totalPages:0,totalThreads:0}}}static async createPost(e){console.log("Creating post:",e);let t=await fetch("/api/threads/".concat(e.threadId,"/posts"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to create post"}))).error||"Failed to create post");return t.json()}static async getThread(e){try{let t=await fetch("/api/threads/".concat(e),{cache:"no-store",headers:{"Cache-Control":"no-cache"}});if(!t.ok){if(404===t.status)return{success:!1,error:"Thread not found"};let e=await t.json().catch(()=>({error:"Failed to get thread"}));return{success:!1,error:e.error||"Failed to get thread"}}return await t.json()}catch(e){return{success:!1,error:"Failed to load thread"}}}}}}]);