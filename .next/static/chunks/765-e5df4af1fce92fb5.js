"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[765],{2369:function(e,t,a){a.d(t,{Z:function(){return s}});let s=(0,a(9763).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},6765:function(e,t,a){a.d(t,{s:function(){return w}});var s=a(7437),l=a(2265),r=a(9763);let i=(0,r.Z)("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);var n=a(1047);let o=(0,r.Z)("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),c=(0,r.Z)("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),d=(0,r.Z)("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),p=(0,r.Z)("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),m=(0,r.Z)("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);var u=a(2489);let x=e=>{let{post:t,isOP:a=!1}=e,[r,x]=(0,l.useState)(!1),[h,g]=(0,l.useState)(!1),[y,b]=(0,l.useState)(null),[j,f]=(0,l.useState)(!1),v=()=>{f(!j)};try{return(0,s.jsxs)("div",{className:"".concat(a?"bg-orange-50 border-orange-300":"bg-white border-orange-200"," border rounded-lg p-4 mb-4 shadow-sm"),children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4 mb-3",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-orange-500",children:[(0,s.jsx)(i,{size:14}),(0,s.jsx)("span",{className:"font-mono",children:t.id})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[(0,s.jsx)(n.Z,{size:14}),(0,s.jsx)("span",{children:(e=>{try{if(null==e)return"No date";let t="string"==typeof e?new Date(e):e;if(isNaN(t.getTime()))return console.warn("Invalid date value:",e),"Invalid date";return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)}catch(t){return console.error("Error formatting date:",t,e),"Invalid date"}})(t.timestamp)})]}),(0,s.jsx)("div",{className:"flex items-center space-x-1 text-sm text-gray-600",children:(0,s.jsx)("span",{className:"font-medium",children:t.authorDisplayName||(t.isAnonymous?"Anonymous":t.authorWallet?"".concat(t.authorWallet.slice(0,8),"..."):"Unknown")})}),a&&(0,s.jsx)("span",{className:"bg-gradient-to-r from-orange-500 to-pink-500 text-white text-xs px-2 py-1 rounded",children:"OP"})]}),(t.image||t.video)&&(0,s.jsxs)("div",{className:"w-full mb-4",children:[t.image&&(0,s.jsxs)("div",{className:"relative flex justify-center",children:[(0,s.jsx)("img",{src:t.imageThumb||t.image,alt:"Post image",className:"max-w-full h-auto rounded-lg cursor-pointer hover:opacity-80 transition-opacity",style:{maxHeight:"600px",maxWidth:"100%",objectFit:"contain"},onClick:v}),(0,s.jsx)("button",{onClick:v,className:"absolute top-2 right-2 bg-black bg-opacity-50 text-white p-1 rounded hover:bg-opacity-70 transition-all",title:"Click to expand",children:(0,s.jsx)(o,{size:14})})]}),t.video&&!t.image&&(0,s.jsxs)("div",{className:"relative flex justify-center bg-gray-900 rounded-lg overflow-hidden",children:[(0,s.jsx)("video",{ref:b,src:t.video,className:"max-w-full h-auto rounded-lg",style:{maxHeight:"600px",maxWidth:"100%",objectFit:"contain"},onEnded:()=>{x(!1)},muted:h,loop:!0}),(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsx)("button",{onClick:()=>{y&&(r?y.pause():y.play(),x(!r))},className:"bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-70 transition-all",children:r?(0,s.jsx)(c,{size:16}):(0,s.jsx)(d,{size:16})})}),(0,s.jsx)("div",{className:"absolute bottom-2 right-2",children:(0,s.jsx)("button",{onClick:()=>{y&&(y.muted=!h,g(!h))},className:"bg-black bg-opacity-50 text-white p-1 rounded hover:bg-opacity-70 transition-all",children:h?(0,s.jsx)(p,{size:12}):(0,s.jsx)(m,{size:12})})}),(0,s.jsx)("button",{onClick:()=>{t.video&&window.open(t.video,"_blank")},className:"absolute top-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded hover:bg-opacity-70 transition-all",children:"Open"})]})]}),t.content&&(0,s.jsx)("div",{className:"w-full",children:(0,s.jsx)("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed",children:t.content})}),j&&t.image&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"relative max-w-4xl max-h-full",children:[(0,s.jsx)("img",{src:t.image,alt:"Expanded post image",className:"max-w-full max-h-full object-contain rounded-lg"}),(0,s.jsx)("button",{onClick:v,className:"absolute top-4 right-4 bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-70 transition-all",children:(0,s.jsx)(u.Z,{size:20})}),(0,s.jsx)("a",{href:t.image,download:!0,className:"absolute bottom-4 right-4 bg-black bg-opacity-50 text-white px-3 py-2 rounded hover:bg-opacity-70 transition-all text-sm",target:"_blank",rel:"noopener noreferrer",children:"Download"})]})})]})}catch(e){return console.error("Error rendering PostComponent:",e,t),(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:(0,s.jsxs)("p",{className:"text-red-600",children:["Error displaying post: ",t.id]})})}};var h=a(1995),g=a(2660),y=a(3417),b=a(2369),j=a(6541),f=a(3545),v=a(8223);let w=e=>{let{thread:t,onBack:a}=e,[r,i]=(0,l.useState)(!1),[n,o]=(0,l.useState)(t),[c,d]=(0,l.useState)(!1),[p,m]=(0,l.useState)(!1),[u,w]=(0,l.useState)([]),[N,k]=(0,l.useState)(!1),{wallet:C}=(0,j.O)(),{processPayment:S}=(0,f.J)(),P=(0,l.useCallback)(async()=>{try{d(!0),console.log("Refreshing thread data...");let e="/api/threads/".concat(n.id,"/posts"),t=await fetch(e,{cache:"no-store",headers:{"Cache-Control":"no-cache"}});if(t.ok){let e=await t.json();if(e.thread){let t=e.thread;o(e=>{let a=(e.replies||[]).filter(e=>!t.replies.some(t=>t.id===e.id)&&e.id.startsWith("temp_"));return{...t,replies:[...t.replies,...a],replyCount:t.replyCount+a.length}}),console.log("Thread data refreshed successfully with optimistic merge")}else console.error("Failed to refresh thread data: Invalid response structure")}else console.error("Failed to refresh thread data:",t.status)}catch(e){console.error("Error refreshing thread data:",e)}finally{d(!1)}},[n.id,n.slug]),R=(0,l.useCallback)(e=>{let t="temp_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),a={...e,id:t};return o(e=>({...e,replies:[...e.replies||[],a],replyCount:(e.replyCount||0)+1,lastReply:new Date,lastActivity:new Date})),t},[]),z=(0,l.useCallback)(async()=>{for(let e of u.filter(e=>"pending"===e.status))try{w(t=>t.map(t=>t.id===e.id?{...t,status:"uploading"}:t)),console.log("Processing upload: ".concat(e.id)),await T(e),w(t=>t.map(t=>t.id===e.id?{...t,status:"completed"}:t)),console.log("Upload completed: ".concat(e.id))}catch(t){console.error("Upload failed: ".concat(e.id),t),w(t=>t.map(t=>t.id===e.id?{...t,status:"failed"}:t)),o(t=>({...t,replies:t.replies.filter(t=>t.id!==e.data.tempId),replyCount:Math.max(0,t.replyCount-1)})),alert("Failed to create reply: ".concat(t instanceof Error?t.message:"Unknown error",". Please try again."))}setTimeout(()=>{w(e=>e.filter(e=>"completed"!==e.status))},5e3)},[u]),T=(0,l.useCallback)(async e=>{let{data:t}=e,a=null,s=null;t.image&&C.publicKey&&console.log("Image uploaded:",a=(await v.s.uploadFile(t.image,C.publicKey)).url),t.video&&C.publicKey&&console.log("Video uploaded:",s=(await v.s.uploadFile(t.video,C.publicKey)).url);let l={content:t.content,image:a,video:s,authorWallet:C.publicKey||"anonymous"};console.log("Creating reply with data:",l),console.log("Sending reply creation request to server...");let r=await fetch("/api/threads/".concat(n.id,"/posts"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(402===r.status&&(await r.json()).requiresPayment){console.log("Payment required, processing payment...");let e=await S();if(!e)throw Error("Payment failed or was cancelled");l.paymentSignature=e,r=await fetch("/api/threads/".concat(n.id,"/posts"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})}if(!r.ok){let e=await r.json().catch(()=>({error:"Failed to create reply"}));throw console.error("Reply creation error:",e),Error("HTTP error! status: ".concat(r.status,", message: ").concat(e.error||"Unknown error"))}let i=await r.json();if(console.log("Reply created successfully:",i),!i.success||!i.post)throw console.error("Invalid reply creation result:",i),Error("Invalid response from server");console.log("Updating optimistic reply ".concat(t.tempId," with server data ").concat(i.post.id)),o(e=>{let l=e.replies.map(e=>e.id===t.tempId?{...e,id:i.post.id,timestamp:new Date(i.post.timestamp),image:a||null,imageThumb:a||null,video:s||null}:e);return console.log("Thread now has ".concat(l.length," replies after server update")),console.log("Updated reply IDs:",l.map(e=>e.id)),{...e,replies:l,replyCount:e.replyCount,lastReply:new Date,lastActivity:new Date}}),w(t=>t.map(t=>t.id===e.id?{...t,status:"completed"}:t)),console.log("Upload completed: ".concat(e.id)),u.map(t=>t.id===e.id?{...t,status:"completed"}:t).every(e=>"completed"===e.status)&&(k(!0),setTimeout(()=>k(!1),3e3))},[C.publicKey,n.id,u]);(0,l.useEffect)(()=>{u.length>0&&z()},[u,z]);let U=(0,l.useCallback)(async e=>{try{if(!C.connected||!C.publicKey){alert("Please connect your Solana wallet to post");return}m(!0);let t={id:"",timestamp:new Date,content:e.content||null,image:e.image?URL.createObjectURL(e.image):null,imageThumb:e.image?URL.createObjectURL(e.image):null,video:e.video?URL.createObjectURL(e.video):null,authorWallet:C.publicKey||"anonymous",isAnonymous:!0},a=R(t),s="upload_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9));w(t=>[...t,{id:s,data:{...e,tempId:a},status:"pending"}]),i(!1)}catch(e){console.error("Failed to create reply:",e),alert("Failed to create reply. Please try again.")}finally{m(!1)}},[C,R]);return n?(0,s.jsxs)("div",{className:"max-w-4xl mx-auto p-6 bg-gradient-to-br from-orange-50 to-pink-50 min-h-screen",children:[N&&(0,s.jsx)("div",{className:"fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-in slide-in-from-right duration-300",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{className:"text-xl",children:"✅"}),(0,s.jsx)("span",{children:"Reply posted successfully!"})]})}),(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("button",{onClick:a,className:"flex items-center space-x-2 text-orange-600 hover:text-orange-700 transition-colors",children:[(0,s.jsx)(g.Z,{size:20}),(0,s.jsx)("span",{children:"Back"})]}),(0,s.jsxs)("button",{onClick:P,disabled:c,className:"flex items-center space-x-2 text-orange-600 hover:text-orange-700 transition-colors disabled:opacity-50",children:[(0,s.jsx)(y.Z,{size:20}),(0,s.jsx)("span",{children:c?"Refreshing...":"Refresh"})]})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-orange-600 mb-4",children:n.title||"Untitled Thread"}),u.length>0&&(0,s.jsxs)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse"}),(0,s.jsx)("span",{className:"text-blue-700 font-medium",children:"Processing Reply"})]}),(0,s.jsxs)("span",{className:"text-blue-600 text-sm",children:[u.filter(e=>"completed"===e.status).length,"/",u.length," completed"]})]}),(0,s.jsx)("div",{className:"mt-2 space-y-2",children:u.map(e=>(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{className:"flex-1 bg-blue-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 ".concat("completed"===e.status?"bg-green-500":"uploading"===e.status?"bg-blue-500":"failed"===e.status?"bg-red-500":"bg-blue-300"),style:{width:"completed"===e.status?"100%":"uploading"===e.status?"50%":"0%"}})}),(0,s.jsx)("span",{className:"text-xs text-blue-600 w-16 text-right",children:"completed"===e.status?"✓":"uploading"===e.status?"⏳":"failed"===e.status?"✗":"⏸️"})]},e.id))}),u.every(e=>"completed"===e.status)&&(0,s.jsx)("div",{className:"mt-3 p-2 bg-green-50 border border-green-200 rounded text-center",children:(0,s.jsx)("span",{className:"text-green-700 text-sm",children:"✅ Reply posted successfully!"})})]}),n.op?(0,s.jsx)(x,{post:n.op,isOP:!0}):(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,s.jsx)("p",{className:"text-red-600",children:"Error: Thread OP not found"})})]}),(0,s.jsx)("div",{className:"space-y-4",children:Array.isArray(n.replies)?n.replies.map(e=>{try{if(!e||!e.id)return console.warn("Invalid reply data:",e),null;return(0,s.jsx)(x,{post:e},e.id)}catch(t){return console.error("Error rendering reply:",t,e),(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,s.jsxs)("p",{className:"text-red-600",children:["Error displaying reply: ",e.id||"unknown"]})},e.id||"unknown")}}):(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(y.Z,{className:"mx-auto text-orange-400 mb-4",size:32}),(0,s.jsx)("p",{className:"text-orange-500 mb-6",children:"No replies yet. Be the first to reply!"})]})}),r&&(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)(h.s,{isReply:!0,onSubmit:U,onCancel:()=>i(!1)})}),(0,s.jsx)("div",{className:"text-center py-8 border-t border-orange-200 mt-6",children:C.connected&&C.publicKey?(0,s.jsxs)("button",{onClick:()=>i(!r),disabled:p||u.length>0,className:"flex items-center space-x-2 bg-gradient-to-r from-orange-500 to-pink-500 hover:from-orange-600 hover:to-pink-600 text-white px-6 py-3 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg mx-auto disabled:opacity-50",children:[(0,s.jsx)(y.Z,{size:18}),(0,s.jsx)("span",{children:p?"Posting...":u.length>0?"Uploading (".concat(u.length,")"):"Reply"})]}):(0,s.jsx)("div",{className:"text-center",children:(0,s.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-blue-800 mb-2",children:[(0,s.jsx)(b.Z,{size:20}),(0,s.jsx)("span",{className:"font-medium",children:"Wallet Connection Required"})]}),(0,s.jsx)("p",{className:"text-blue-700 text-sm mb-4",children:"Connect your Solana wallet to reply to threads."})]})})})]}):(console.error("ThreadView: No thread provided"),(0,s.jsx)("div",{className:"max-w-4xl mx-auto p-6 bg-gradient-to-br from-orange-50 to-pink-50 min-h-screen",children:(0,s.jsx)("div",{className:"text-center py-8",children:(0,s.jsx)("p",{className:"text-red-600",children:"Error: No thread data available"})})}))}}}]);