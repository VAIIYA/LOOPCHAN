(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[535],{2538:function(e,t,o){Promise.resolve().then(o.bind(o,7915))},7915:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return r}});var n=o(7437),l=o(2265),a=o(9376),c=o(6765);function r(){let e=(0,a.useParams)(),t=(0,a.useRouter)(),[o,r]=(0,l.useState)(null),[s,i]=(0,l.useState)(!0),[d,u]=(0,l.useState)(null),[h,g]=(0,l.useState)(0),w=e.slug,m=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{console.log("Attempting to load thread by slug: ".concat(w," (attempt ").concat(e,")"));let n=await fetch("/api/threads/slug/".concat(w),{cache:"no-store",headers:{"Cache-Control":"no-cache"}});if(!n.ok){if(404===n.status)throw Error("Thread not found");throw Error("HTTP ".concat(n.status,": ").concat(n.statusText))}let l=await n.json();if(l.success&&l.thread){var t,o;console.log("Thread loaded successfully: ".concat(l.thread.title)),console.log("Thread has ".concat((null===(t=l.thread.replies)||void 0===t?void 0:t.length)||0," replies")),console.log("Reply IDs:",(null===(o=l.thread.replies)||void 0===o?void 0:o.map(e=>e.id))||[]),r(l.thread),u(null),g(0)}else throw Error(l.error||"Failed to load thread")}catch(o){let t=o instanceof Error?o.message:"Unknown error";if(console.error("Thread load attempt ".concat(e," failed:"),t),e<10){let t=Math.min(1e3*Math.pow(1.5,e-1),1e4);console.log("Thread not found, retrying in ".concat(t,"ms... (attempt ").concat(e,"/10)")),setTimeout(()=>{g(e),m(e+1)},t)}else console.error("All retry attempts failed"),u(t),g(e)}finally{i(!1)}};return((0,l.useEffect)(()=>{w&&m()},[w]),s)?(0,n.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Loading thread..."}),h>0&&(0,n.jsxs)("p",{className:"text-sm text-gray-500 mt-2",children:["Retry attempt ",h,"/10"]})]})}):d?(0,n.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-8 max-w-md w-full mx-4",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Thread Not Found"}),(0,n.jsx)("p",{className:"text-gray-600 mb-6",children:"The requested thread could not be found."}),(0,n.jsxs)("div",{className:"flex gap-4",children:[(0,n.jsx)("button",{onClick:()=>t.push("/"),className:"bg-orange-500 text-white px-6 py-2 rounded hover:bg-orange-600 transition-colors",children:"Back to Homepage"}),(0,n.jsx)("button",{onClick:()=>{i(!0),u(null),g(0),m()},className:"bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600 transition-colors",children:"Try Again"})]})]})}):o?(0,n.jsx)("div",{className:"min-h-screen bg-gray-100",children:(0,n.jsx)(c.s,{thread:o,onBack:()=>t.push("/")})}):(0,n.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,n.jsx)("div",{className:"text-center",children:(0,n.jsx)("p",{className:"text-gray-600",children:"No thread data available"})})})}},6541:function(e,t,o){"use strict";o.d(t,{O:function(){return r},WalletProvider:function(){return s}});var n=o(7437),l=o(2265),a=o(2957).Buffer;let c=(0,l.createContext)(void 0),r=()=>{let e=(0,l.useContext)(c);if(!e)throw console.error("useWallet must be used within a WalletProvider"),Error("useWallet must be used within a WalletProvider");return e},s=e=>{let{children:t}=e,[o,r]=(0,l.useState)({publicKey:"",connected:!1,connecting:!1});(0,l.useEffect)(()=>{(()=>{try{{let e=localStorage.getItem("loopchan-wallet");if(e)try{let t=JSON.parse(e);console.log("Loading saved wallet state:",t),r(t)}catch(e){console.error("Failed to parse saved wallet state:",e),localStorage.removeItem("loopchan-wallet")}}}catch(e){console.error("Error loading wallet state:",e),r({publicKey:"",connected:!1,connecting:!1}),localStorage.removeItem("loopchan-wallet")}})()},[]),(0,l.useEffect)(()=>{try{o.connected?(localStorage.setItem("loopchan-wallet",JSON.stringify(o)),console.log("Wallet state saved to localStorage")):(localStorage.removeItem("loopchan-wallet"),console.log("Wallet state removed from localStorage"))}catch(e){console.error("Error saving wallet state to localStorage:",e)}},[o]),(0,l.useEffect)(()=>{(()=>{try{if("solana"in window){let e=window.solana;if((null==e?void 0:e.isPhantom)&&e.isConnected&&!o.connected){let t=e.publicKey.toString();console.log("Auto-detected connected wallet:",t),r({publicKey:t,connected:!0,connecting:!1})}}}catch(e){console.error("Error checking wallet availability:",e)}})();let e=()=>{try{let e=window.solana;if(null==e?void 0:e.isConnected){let t=e.publicKey.toString();console.log("Wallet connected event:",t);let o={publicKey:t,connected:!0,connecting:!1};r(o),localStorage.setItem("loopchan-wallet",JSON.stringify(o))}}catch(e){console.error("Error handling wallet connect event:",e)}},t=()=>{try{console.log("Wallet disconnected event"),r({publicKey:"",connected:!1,connecting:!1}),localStorage.removeItem("loopchan-wallet")}catch(e){console.error("Error handling wallet disconnect event:",e)}};try{if("solana"in window){let o=window.solana;return null==o||o.on("connect",e),null==o||o.on("disconnect",t),()=>{null==o||o.off("connect",e),null==o||o.off("disconnect",t)}}}catch(e){console.error("Error setting up wallet event listeners:",e)}},[o.connected]),(0,l.useEffect)(()=>{let e=()=>{try{if("solana"in window){let e=window.solana;if((null==e?void 0:e.isPhantom)&&e.isConnected){let t=e.publicKey.toString(),n=localStorage.getItem("loopchan-wallet");if(n)try{let e=JSON.parse(n);e.connected&&e.publicKey===t&&(!o.connected||o.publicKey!==t)&&(console.log("Restoring wallet state on page load:",t),r({publicKey:t,connected:!0,connecting:!1}))}catch(e){console.error("Error parsing saved wallet on page load:",e)}}}}catch(e){console.error("Error checking wallet on page load:",e)}};e();let t=setTimeout(e,100);return()=>clearTimeout(t)},[]);let s=async()=>{try{if(r(e=>({...e,connecting:!0})),"solana"in window){let e=window.solana;if(null==e?void 0:e.isPhantom)try{let t=(await e.connect()).publicKey.toString(),o={publicKey:t,connected:!0,connecting:!1};r(o),localStorage.setItem("loopchan-wallet",JSON.stringify(o)),console.log("Wallet connected successfully:",t)}catch(e){throw console.error("Phantom connect failed:",e),e}else console.warn("Phantom wallet not detected"),window.open("https://phantom.app/","_blank")}else console.warn("Solana wallet not available"),window.open("https://phantom.app/","_blank")}catch(e){throw console.error("Failed to connect wallet:",e),r(e=>({...e,connecting:!1})),e}},i=async e=>{try{if(!o.connected)throw Error("Wallet not connected");if("solana"in window){let t=window.solana;if(!(null==t?void 0:t.isPhantom))throw Error("Phantom wallet not available");let o=new TextEncoder().encode(e),n=await t.signMessage(o,"utf8");if(!(null==n?void 0:n.signature))throw Error("No signature received from wallet");let l=a.from(n.signature).toString("base64");return console.log("Message signed successfully"),l}throw Error("Solana wallet not available")}catch(e){throw console.error("Failed to sign message:",e),e}};return(0,n.jsx)(c.Provider,{value:{wallet:o,connect:s,disconnect:()=>{try{if("solana"in window){let e=window.solana;null==e||e.disconnect()}r({publicKey:"",connected:!1,connecting:!1}),localStorage.removeItem("loopchan-wallet"),console.log("Wallet disconnected successfully")}catch(e){console.error("Error disconnecting wallet:",e),r({publicKey:"",connected:!1,connecting:!1}),localStorage.removeItem("loopchan-wallet")}},signMessage:i},children:t})}}},function(e){e.O(0,[180,814,957,990,170,765,971,117,744],function(){return e(e.s=2538)}),_N_E=e.O()}]);